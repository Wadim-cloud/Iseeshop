{
  "version": 3,
  "sources": ["../../../../Documents/Devops/Drawi/.netlify/v1/functions/check-rate-limit.js"],
  "sourceRoot": "C:/Users/ReMarkt/AppData/Local/Temp/tmp-27924-2NrkeBQAFy7r",
  "sourcesContent": ["// netlify/functions/check-rate-limit.js\r\nexport async function handler(event) {\r\n  try {\r\n    let userId;\r\n    try {\r\n      userId = JSON.parse(event.body)?.userId;\r\n    } catch {\r\n      return {\r\n        statusCode: 400,\r\n        body: JSON.stringify({ error: 'Invalid request body' })\r\n      };\r\n    }\r\n    if (!userId) {\r\n      return {\r\n        statusCode: 400,\r\n        body: JSON.stringify({ error: 'User ID required' })\r\n      };\r\n    }\r\n    const submissions = global.submissions || new Map();\r\n    global.submissions = submissions;\r\n    const now = Date.now();\r\n    const oneMinute = 60 * 1000;\r\n    let userSubmissions = submissions.get(userId) || [];\r\n    userSubmissions = userSubmissions.filter(ts => now - ts < oneMinute);\r\n    userSubmissions.push(now);\r\n    submissions.set(userId, userSubmissions);\r\n    const count = userSubmissions.length;\r\n    if (count > 10) {\r\n      return {\r\n        statusCode: 429,\r\n        body: JSON.stringify({\r\n          blocked: true,\r\n          limited: true,\r\n          message: 'Too many submissions. Temporarily banned.'\r\n        })\r\n      };\r\n    }\r\n    if (count > 5) {\r\n      return {\r\n        statusCode: 429,\r\n        body: JSON.stringify({\r\n          blocked: false,\r\n          limited: true,\r\n          message: 'Warning: Slow down, nearing submission limit.'\r\n        })\r\n      };\r\n    }\r\n    return {\r\n      statusCode: 200,\r\n      body: JSON.stringify({\r\n        blocked: false,\r\n        limited: false,\r\n        message: 'OK'\r\n      })\r\n    };\r\n  } catch (error) {\r\n    console.error('Rate limit error:', error);\r\n    return {\r\n      statusCode: 500,\r\n      body: JSON.stringify({ error: 'Internal server error' })\r\n    };\r\n  }\r\n}"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,eAAsB,QAAQ,OAAO;AACnC,MAAI;AACF,QAAI;AACJ,QAAI;AACF,eAAS,KAAK,MAAM,MAAM,IAAI,GAAG;AAAA,IACnC,QAAQ;AACN,aAAO;AAAA,QACL,YAAY;AAAA,QACZ,MAAM,KAAK,UAAU,EAAE,OAAO,uBAAuB,CAAC;AAAA,MACxD;AAAA,IACF;AACA,QAAI,CAAC,QAAQ;AACX,aAAO;AAAA,QACL,YAAY;AAAA,QACZ,MAAM,KAAK,UAAU,EAAE,OAAO,mBAAmB,CAAC;AAAA,MACpD;AAAA,IACF;AACA,UAAM,cAAc,OAAO,eAAe,oBAAI,IAAI;AAClD,WAAO,cAAc;AACrB,UAAM,MAAM,KAAK,IAAI;AACrB,UAAM,YAAY,KAAK;AACvB,QAAI,kBAAkB,YAAY,IAAI,MAAM,KAAK,CAAC;AAClD,sBAAkB,gBAAgB,OAAO,QAAM,MAAM,KAAK,SAAS;AACnE,oBAAgB,KAAK,GAAG;AACxB,gBAAY,IAAI,QAAQ,eAAe;AACvC,UAAM,QAAQ,gBAAgB;AAC9B,QAAI,QAAQ,IAAI;AACd,aAAO;AAAA,QACL,YAAY;AAAA,QACZ,MAAM,KAAK,UAAU;AAAA,UACnB,SAAS;AAAA,UACT,SAAS;AAAA,UACT,SAAS;AAAA,QACX,CAAC;AAAA,MACH;AAAA,IACF;AACA,QAAI,QAAQ,GAAG;AACb,aAAO;AAAA,QACL,YAAY;AAAA,QACZ,MAAM,KAAK,UAAU;AAAA,UACnB,SAAS;AAAA,UACT,SAAS;AAAA,UACT,SAAS;AAAA,QACX,CAAC;AAAA,MACH;AAAA,IACF;AACA,WAAO;AAAA,MACL,YAAY;AAAA,MACZ,MAAM,KAAK,UAAU;AAAA,QACnB,SAAS;AAAA,QACT,SAAS;AAAA,QACT,SAAS;AAAA,MACX,CAAC;AAAA,IACH;AAAA,EACF,SAAS,OAAO;AACd,YAAQ,MAAM,qBAAqB,KAAK;AACxC,WAAO;AAAA,MACL,YAAY;AAAA,MACZ,MAAM,KAAK,UAAU,EAAE,OAAO,wBAAwB,CAAC;AAAA,IACzD;AAAA,EACF;AACF;",
  "names": []
}
