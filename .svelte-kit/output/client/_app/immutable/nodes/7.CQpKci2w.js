import{t as h,a as v,b as $e}from"../chunks/fM_HHR7z.js";import{i as at}from"../chunks/Dcs68N15.js";import{p as st,o as ot,au as Ye,av as it,a as lt,aw as ct,ar as a,as as t,A as b,I as Q,x as r,at as e,aq as A,w as V,ap as dt,af as W}from"../chunks/Cw_GAJ-8.js";import{h as vt,e as M,s as u}from"../chunks/tsz7uQk5.js";import{i as Z}from"../chunks/JX9NnDbc.js";import{e as qe,i as ye}from"../chunks/C5uFXPOK.js";import{s as Ge,r as X}from"../chunks/5A2ZYZT-.js";import{s as nt}from"../chunks/B3wL8fD2.js";import{s as ut}from"../chunks/DrJ5GnEB.js";import{b as ee}from"../chunks/BlA1OJav.js";import{p as mt}from"../chunks/Bfc47y5P.js";import{s as pt,a as De}from"../chunks/BbjLjIkL.js";import{c as Ne,a as je,b as _t}from"../chunks/BYbTja4Y.js";import{s as we}from"../chunks/DTVZafTn.js";import{g as ft,w as gt}from"../chunks/DV9TUGiz.js";import{g as Pe}from"../chunks/E_7-NnNK.js";const bt=[{id:"mug",name:"Coffee Mug",price:19.99},{id:"tshirt",name:"T-Shirt",price:24.99},{id:"poster",name:"Poster",price:14.99},{id:"phonecase",name:"Phone Case",price:29.99},{id:"pillow",name:"Throw Pillow",price:34.99}];async function ht(C){try{const S=ft(Ne);if(!S||S.length===0)return{success:!1,error:"Cart is empty"};const te=S.map(c=>{const p=bt.find(o=>o.id===c.selected3DObject);if(!p)throw new Error(`Invalid 3D object selected for drawing ${c.drawingId}`);return{drawingId:c.drawingId,price:p.price,selected3DObject:c.selected3DObject}}),xe=te.reduce((c,p)=>c+p.price,0),{data:m,error:O}=await we.from("orders").insert({buyer_name:C.name,buyer_email:C.email,buyer_address:C.address,buyer_city:C.city,buyer_state:C.state,buyer_zip:C.zipCode,buyer_country:C.country,total_amount:xe,status:"pending",order_date:new Date().toISOString()}).select("id").single();if(O||!m)return console.error("Error creating order:",O),{success:!1,error:"Failed to create order"};const re=m.id,fe=te.map(c=>({order_id:re,drawing_id:c.drawingId,price:c.price,selected_3d_object:c.selected3DObject||null})),{error:I}=await we.from("order_items").insert(fe);if(I)return console.error("Error creating order items:",I),await we.from("orders").delete().eq("id",re),{success:!1,error:"Failed to create order items"};const{error:$}=await we.from("orders").update({status:"completed"}).eq("id",re);return $&&console.error("Error updating order status:",$),je.clearCart(),{success:!0,orderId:re}}catch(S){return console.error("Checkout error:",S),{success:!1,error:S instanceof Error?S.message:"An unexpected error occurred during checkout"}}}var qt=h('<meta name="description" content="Complete your order">'),yt=h('<div class="empty-checkout svelte-umoqr3"><p>Your cart is empty.</p> <button class="back-button svelte-umoqr3">Return to Gallery</button></div>'),wt=h('<div><div class="object-image svelte-umoqr3"><div class="object-placeholder svelte-umoqr3"><span> </span></div></div> <div class="object-info svelte-umoqr3"><span class="object-name svelte-umoqr3"> </span> <span class="object-price svelte-umoqr3"> </span></div></div>'),jt=h('<div class="mock-3d-object svelte-umoqr3"><span> </span> <div class="texture-overlay svelte-umoqr3"></div></div>'),xt=h('<div class="checkout-item svelte-umoqr3"><div class="item-image svelte-umoqr3"><img alt="Drawing preview" class="svelte-umoqr3"> <button class="remove-button svelte-umoqr3"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M18 6L6 18M6 6l12 12"></path></svg></button></div> <div class="item-options svelte-umoqr3"><h3>Select 3D Object</h3> <div class="objects-grid svelte-umoqr3"></div> <div class="preview-section svelte-umoqr3"><h4>Preview</h4> <div class="preview-3d svelte-umoqr3"><div class="preview-placeholder svelte-umoqr3"><!></div></div></div></div></div>'),kt=h('<div class="summary-item svelte-umoqr3"><span> </span> <span> </span></div>'),Ct=h('<div class="checkout-content svelte-umoqr3"><div class="checkout-items svelte-umoqr3"></div> <div class="checkout-summary svelte-umoqr3"><h2 class="svelte-umoqr3">Order Summary</h2> <div class="summary-items svelte-umoqr3"></div> <div class="summary-total svelte-umoqr3"><span>Total</span> <span> </span></div> <div class="checkout-actions svelte-umoqr3"><button class="back-button svelte-umoqr3">Continue Shopping</button> <button class="update-totals-button svelte-umoqr3">Update Totals</button> <button class="checkout-button svelte-umoqr3">Continue to Shipping</button></div></div></div>'),St=h('<div class="summary-item svelte-umoqr3"><img alt="Drawing preview" class="item-thumbnail svelte-umoqr3"> <div class="item-details svelte-umoqr3"><span class="item-id svelte-umoqr3"> </span> <span class="item-price"> </span></div></div>'),Ot=h('<div class="error-message svelte-umoqr3"> </div>'),It=h('<div class="cart-summary svelte-umoqr3"><h2 class="svelte-umoqr3">Order Summary</h2> <div class="summary-items svelte-umoqr3"></div> <div class="summary-total svelte-umoqr3"><span> </span> <span class="total-amount svelte-umoqr3"> </span></div></div> <div class="checkout-form svelte-umoqr3"><h2 class="svelte-umoqr3">Shipping Information</h2> <!> <form><div class="form-group svelte-umoqr3"><label for="name" class="svelte-umoqr3">Full Name</label> <input type="text" id="name" required class="svelte-umoqr3"></div> <div class="form-group svelte-umoqr3"><label for="email" class="svelte-umoqr3">Email Address</label> <input type="email" id="email" required class="svelte-umoqr3"></div> <div class="form-group svelte-umoqr3"><label for="address" class="svelte-umoqr3">Street Address</label> <input type="text" id="address" required class="svelte-umoqr3"></div> <div class="form-row svelte-umoqr3"><div class="form-group svelte-umoqr3"><label for="city" class="svelte-umoqr3">City</label> <input type="text" id="city" required class="svelte-umoqr3"></div> <div class="form-group svelte-umoqr3"><label for="state" class="svelte-umoqr3">State/Province</label> <input type="text" id="state" required class="svelte-umoqr3"></div></div> <div class="form-row svelte-umoqr3"><div class="form-group svelte-umoqr3"><label for="zipCode" class="svelte-umoqr3">Zip/Postal Code</label> <input type="text" id="zipCode" required class="svelte-umoqr3"></div> <div class="form-group svelte-umoqr3"><label for="country" class="svelte-umoqr3">Country</label> <input type="text" id="country" required class="svelte-umoqr3"></div></div> <div class="form-actions svelte-umoqr3"><button type="button" class="secondary-button svelte-umoqr3">Back to Products</button> <button type="submit" class="primary-button svelte-umoqr3"> </button></div></form></div>',1),$t=h('<div class="success-message svelte-umoqr3"><svg viewBox="0 0 24 24" width="48" height="48" fill="none" stroke="#4CAF50" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><path d="M22 4 12 14.01l-3-3"></path></svg> <h2 class="svelte-umoqr3">Purchase Complete!</h2> <p> </p> <p>You will receive a confirmation email shortly.</p> <button class="primary-button svelte-umoqr3">Back to Gallery</button></div>'),Dt=h('<div class="checkout-container svelte-umoqr3"><h1 class="svelte-umoqr3"><!></h1> <!></div>');function Ht(C,S){st(S,!1);const[te,xe]=pt(),m=()=>De(Ne,"$cartStore",te),O=()=>De(c,"$selectedObjects",te),re=()=>De(_t,"$cartSize",te),fe=Q(),I=Q(),$=[{id:"mug",name:"Coffee Mug",price:19.99,image:"/images/objects/mug.jpg"},{id:"tshirt",name:"T-Shirt",price:24.99,image:"/images/objects/tshirt.jpg"},{id:"poster",name:"Poster",price:14.99,image:"/images/objects/poster.jpg"},{id:"phonecase",name:"Phone Case",price:29.99,image:"/images/objects/phonecase.jpg"},{id:"pillow",name:"Throw Pillow",price:34.99,image:"/images/objects/pillow.jpg"}],c=gt({});let p=Q("product-selection"),o=Q({name:"",email:"",address:"",city:"",state:"",zipCode:"",country:""}),ge=Q(!1),de=Q(null),Ee=Q();ot(()=>{m().length>0?m().forEach(s=>{c.update(i=>{if(!i[s.drawingId]){const n=s.selected3DObject||$[0].id;i[s.drawingId]=n,je.updateCartItem(s.drawingId,{selected3DObject:n})}return i})}):Pe("/gallery"),console.log("Cart Store:",m()),console.log("Selected Objects:",O())});function Ue(s,i){c.update(n=>(n[s]=i,n)),je.updateCartItem(s,{selected3DObject:i}),console.log(`Updated selection for drawing ${s}: ${i}`)}function Le(s){je.removeFromCart(s),c.update(i=>i),m().length===0&&Pe("/gallery")}function Te(){let s=0;return m().forEach(i=>{const n=i.selected3DObject,ae=$.find(d=>d.id===n);ae?s+=ae.price:console.warn(`No object found for drawing ${i.drawingId}, objectId: ${n}`)}),console.log("Calculated total:",s),s}function Re(){b(I,Te()),console.log("Totals updated:",r(I))}function Ve(){b(p,"shipping-info")}async function Ze(){b(ge,!0),b(de,null);try{const s=await ht(r(o));s.success?(b(p,"success"),b(Ee,s.orderId)):b(de,s.error||"Purchase failed")}catch(s){b(de,s instanceof Error?s.message:"An unexpected error occurred")}finally{b(ge,!1)}}function He(){b(p,"product-selection")}function ke(){Pe("/gallery")}Ye(()=>m(),()=>{b(fe,m().length===0)}),Ye(()=>{},()=>{b(I,Te())}),it(),at();var Ce=Dt();vt(s=>{var i=qt();ct.title="Checkout | Pexos",v(s,i)});var Se=t(Ce),Je=t(Se);{var Ke=s=>{var i=$e("Your Custom 3D Order");v(s,i)},Qe=(s,i)=>{{var n=d=>{var D=$e("Shipping Information");v(d,D)},ae=d=>{var D=$e("Order Complete");v(d,D)};Z(s,d=>{r(p)==="shipping-info"?d(n):d(ae,!1)},i)}};Z(Je,s=>{r(p)==="product-selection"?s(Ke):s(Qe,!1)})}e(Se);var We=a(Se,2);{var Xe=s=>{var i=yt(),n=a(t(i),2);e(i),M("click",n,ke),v(s,i)},et=(s,i)=>{{var n=d=>{var D=Ct(),ve=t(D);qe(ve,5,m,ye,(H,_)=>{var j=xt(),G=t(j),x=t(G),J=a(x,2);e(G);var N=a(G,2),T=a(t(N),2);qe(T,5,()=>$,ye,(U,g)=>{var k=wt(),q=t(k),L=t(q),K=t(L),z=t(K,!0);e(K),e(L),e(q);var pe=a(q,2),ie=t(pe),he=t(ie,!0);e(ie);var le=a(ie,2),Oe=t(le);e(le),e(pe),e(k),A(l=>{nt(k,1,`object-option ${O()[r(_).drawingId]===r(g).id?"selected":""}`,"svelte-umoqr3"),u(z,r(g).name),u(he,r(g).name),u(Oe,`$${l??""}`)},[()=>r(g).price.toFixed(2)],V),M("click",k,()=>Ue(r(_).drawingId,r(g).id)),v(U,k)}),e(T);var f=a(T,2),F=a(t(f),2),ne=t(F),ue=t(ne);{var me=U=>{var g=jt();const k=V(()=>$.find(z=>z.id===O()[r(_).drawingId]));var q=t(g),L=t(q,!0);e(q);var K=a(q,2);e(g),A(()=>{var z;u(L,((z=r(k))==null?void 0:z.name)||"Object"),ut(K,`background-image: url(${r(_).imageData??""})`)}),v(U,g)};Z(ue,U=>{O()[r(_).drawingId]&&U(me)})}e(ne),e(F),e(f),e(N),e(j),A(()=>Ge(x,"src",r(_).imageData)),M("click",J,()=>Le(r(_).drawingId)),v(H,j)}),e(ve);var be=a(ve,2),y=a(t(be),2);qe(y,5,m,ye,(H,_)=>{var j=kt();const G=V(()=>$.find(f=>f.id===O()[r(_).drawingId]));var x=t(j),J=t(x,!0);e(x);var N=a(x,2),T=t(N);e(N),e(j),A(f=>{var F;u(J,((F=r(G))==null?void 0:F.name)||"Custom Object"),u(T,`$${f??""}`)},[()=>{var f;return((f=r(G))==null?void 0:f.price.toFixed(2))||"0.00"}],V),v(H,j)}),e(y);var B=a(y,2),Y=a(t(B),2),P=t(Y);e(Y),e(B);var E=a(B,2),w=t(E),se=a(w,2),oe=a(se,2);e(E),e(be),e(D),A(H=>u(P,`$${H??""}`),[()=>r(I).toFixed(2)],V),M("click",w,ke),M("click",se,Re),M("click",oe,Ve),v(d,D)},ae=(d,D)=>{{var ve=y=>{var B=It(),Y=dt(B),P=a(t(Y),2);qe(P,5,m,ye,(l,R)=>{var _e=St();const Fe=V(()=>$.find(ce=>ce.id===O()[r(R).drawingId]));var ze=t(_e),Ae=a(ze,2),Ie=t(Ae),tt=t(Ie,!0);e(Ie);var Me=a(Ie,2),rt=t(Me);e(Me),e(Ae),e(_e),A(ce=>{var Be;Ge(ze,"src",r(R).imageData),u(tt,((Be=r(Fe))==null?void 0:Be.name)||"Custom Object"),u(rt,`$${ce??""}`)},[()=>{var ce;return((ce=r(Fe))==null?void 0:ce.price.toFixed(2))||"0.00"}],V),v(l,_e)}),e(P);var E=a(P,2),w=t(E),se=t(w);e(w);var oe=a(w,2),H=t(oe);e(oe),e(E),e(Y);var _=a(Y,2),j=a(t(_),2);{var G=l=>{var R=Ot(),_e=t(R,!0);e(R),A(()=>u(_e,r(de))),v(l,R)};Z(j,l=>{r(de)&&l(G)})}var x=a(j,2),J=t(x),N=a(t(J),2);X(N),e(J);var T=a(J,2),f=a(t(T),2);X(f),e(T);var F=a(T,2),ne=a(t(F),2);X(ne),e(F);var ue=a(F,2),me=t(ue),U=a(t(me),2);X(U),e(me);var g=a(me,2),k=a(t(g),2);X(k),e(g),e(ue);var q=a(ue,2),L=t(q),K=a(t(L),2);X(K),e(L);var z=a(L,2),pe=a(t(z),2);X(pe),e(z),e(q);var ie=a(q,2),he=t(ie),le=a(he,2),Oe=t(le,!0);e(le),e(ie),e(x),e(_),A((l,R)=>{u(se,`Total (${re()??""} items):`),u(H,`$${l??""}`),le.disabled=r(ge),u(Oe,R)},[()=>r(I).toFixed(2),()=>r(ge)?"Processing...":`Complete Purchase - $${r(I).toFixed(2)}`],V),ee(N,()=>r(o).name,l=>W(o,r(o).name=l)),ee(f,()=>r(o).email,l=>W(o,r(o).email=l)),ee(ne,()=>r(o).address,l=>W(o,r(o).address=l)),ee(U,()=>r(o).city,l=>W(o,r(o).city=l)),ee(k,()=>r(o).state,l=>W(o,r(o).state=l)),ee(K,()=>r(o).zipCode,l=>W(o,r(o).zipCode=l)),ee(pe,()=>r(o).country,l=>W(o,r(o).country=l)),M("click",he,He),M("submit",x,mt(Ze)),v(y,B)},be=(y,B)=>{{var Y=P=>{var E=$t(),w=a(t(E),4),se=t(w);e(w);var oe=a(w,4);e(E),A(()=>u(se,`Your order (#${r(Ee)??""}) has been successfully placed.`)),M("click",oe,ke),v(P,E)};Z(y,P=>{r(p)==="success"&&P(Y)},B)}};Z(d,y=>{r(p)==="shipping-info"?y(ve):y(be,!1)},D)}};Z(s,d=>{r(p)==="product-selection"?d(n):d(ae,!1)},i)}};Z(We,s=>{r(fe)?s(Xe):s(et,!1)})}e(Ce),v(C,Ce),lt(),xe()}export{Ht as component};
