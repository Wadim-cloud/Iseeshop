import"../chunks/CWj6FrbW.js";import"../chunks/69_IOA4Y.js";import{p as ce,o as ve,al as ge,am as we,an as me,a as fe,ao as R,ap as l,x as e,G as q,A as s,aq as _e,ar as i,as as n,w as pe}from"../chunks/9BOlcS-b.js";import{h as ue,s as b,e as G}from"../chunks/BsZz1DC-.js";import{i as h}from"../chunks/WEOj8Vpi.js";import{t as m,a as w}from"../chunks/Bnw62dMu.js";import{s as T}from"../chunks/CTf98LKf.js";import{t as qe,f as be}from"../chunks/BxKlmk9s.js";import{i as he}from"../chunks/xvq0-Hdq.js";import{s as ye,a as ke}from"../chunks/BR43cs2B.js";import{s as J}from"../chunks/BeMxMaC5.js";import{p as xe}from"../chunks/DONeNFOh.js";import{g as K}from"../chunks/zThV1SCZ.js";import{C as De}from"../chunks/DCXUCzZv.js";var Ce=m('<meta name="description" class="svelte-w2ql0i">'),$e=m('<div class="loading svelte-w2ql0i" role="status" aria-live="polite"><div class="spinner svelte-w2ql0i"></div> <p class="svelte-w2ql0i">Loading drawing...</p></div>'),Ie=m('<button class="recent-button svelte-w2ql0i">View Recent Drawing</button>'),Pe=m('<div class="error-message svelte-w2ql0i" role="alert"> <div class="error-actions svelte-w2ql0i"><button class="retry-button svelte-w2ql0i">Retry</button> <!> <button class="gallery-button svelte-w2ql0i">Back to Gallery</button></div></div>'),Re=m('<img class="svelte-w2ql0i">'),Ge=m('<p class="svelte-w2ql0i">No image data available</p>'),Le=m('<div class="drawing-content svelte-w2ql0i"><h1 class="svelte-w2ql0i"> </h1> <div class="drawing-image svelte-w2ql0i"><!></div> <div class="drawing-meta svelte-w2ql0i"><p class="svelte-w2ql0i"><strong class="svelte-w2ql0i">Created by:</strong> </p> <p class="svelte-w2ql0i"><strong class="svelte-w2ql0i">Created on:</strong> </p> <p class="svelte-w2ql0i"><strong class="svelte-w2ql0i">Likes:</strong> </p></div> <button class="comments-button svelte-w2ql0i"> </button></div>'),Me=m('<p class="no-drawing svelte-w2ql0i">Drawing not found.</p>'),Ne=m('<div class="gallery-container svelte-w2ql0i"><!></div> <!>',1);function Qe(O,Q){ce(Q,!1);const[W,X]=ye(),V=()=>ke(xe,"$page",W),c=q();let a=q(null),u=q(null),C=q(!0),f=q(null),y=q(!1);async function B(){var t;if(s(C,!0),s(f,null),!e(c)){s(f,"Invalid drawing ID. Please check the URL."),console.error("Invalid drawing_id:",e(c)),s(C,!1);return}try{const{data:r,error:k,count:M}=await J.from("drawings").select("id, drawing_id, image_data, user_email, created_at, likes, blocked",{count:"exact"}).eq("drawing_id",e(c)).eq("blocked",!1);if(console.log("Fetch result:",{data:r,count:M,fetchError:k}),k)throw new Error(`Failed to fetch drawing: ${k.message}`);!r||r.length===0?(s(f,`Drawing #${e(c)} not found or is not available`),console.warn("No drawing found for drawing_id:",e(c)),s(a,null)):r.length>1?(s(f,"Multiple drawings found with the same ID. Please contact support."),console.error("Multiple drawings returned:",r),s(a,null)):(s(a,r[0]),console.log("Fetched drawing:",e(a)));const{data:d}=await J.from("drawings").select("drawing_id").eq("blocked",!1).order("created_at",{ascending:!1}).limit(1);s(u,((t=d==null?void 0:d[0])==null?void 0:t.drawing_id)||null),console.log("Recent drawing ID:",e(u))}catch(r){s(f,"An error occurred while loading the drawing. Please try again later."),console.error("Error fetching drawing:",r),s(a,null)}s(C,!1)}function H(){s(y,!e(y)),console.log("Comments modal toggled:",e(y))}function U(){console.log("Navigating to gallery"),K("/gallery")}function Y(){e(u)?(console.log("Navigating to recent drawing:",e(u)),K(`/gallery/${e(u)}`)):U()}ve(()=>{console.log("Gallery page mounted for drawing_id:",e(c)),B()}),ge(()=>V(),()=>{s(c,V().params.id)}),we(),he();var j=Ne();ue(t=>{var r=Ce();R(()=>{_e.title=`Pexos - Drawing #${e(c)??""}`,T(r,"content",`View drawing #${e(c)??""} on Pexos, a collaborative creative platform.`)}),w(t,r)});var L=me(j),Z=i(L);{var ee=t=>{var r=$e();w(t,r)},ae=(t,r)=>{{var k=d=>{var x=Pe(),$=i(x),I=l($),v=i(I),g=l(v,2);{var D=_=>{var P=Ie();G("click",P,Y),w(_,P)};h(g,_=>{e(u)&&_(D)})}var N=l(g,2);n(I),n(x),R(()=>b($,`${e(f)??""} `)),G("click",v,B),G("click",N,U),w(d,x)},M=(d,x)=>{{var $=v=>{var g=Le(),D=i(g),N=i(D);n(D);var _=l(D,2),P=i(_);{var se=o=>{var p=Re();R(()=>{T(p,"src",e(a).image_data),T(p,"alt",`Drawing #${e(a).drawing_id??""}`)}),w(o,p)},le=o=>{var p=Ge();w(o,p)};h(P,o=>{e(a).image_data?o(se):o(le,!1)})}n(_);var A=l(_,2),E=i(A),oe=l(i(E));n(E);var F=l(E,2),ie=l(i(F));n(F);var z=l(F,2),ne=l(i(z));n(z),n(A);var S=l(A,2),de=i(S,!0);n(S),n(g),R((o,p)=>{b(N,`Drawing #${e(a).drawing_id??""}`),b(oe,` ${o??""}`),b(ie,` ${p??""}`),b(ne,` ${e(a).likes??""}`),b(de,e(y)?"Hide Comments":"Show Comments")},[()=>{var o;return((o=e(a).user_email)==null?void 0:o.split("@")[0])||"Anonymous"},()=>new Date(e(a).created_at).toLocaleString()],pe),G("click",S,H),qe(1,g,()=>be,()=>({duration:500})),w(v,g)},I=v=>{var g=Me();w(v,g)};h(d,v=>{e(a)?v($):v(I,!1)},x)}};h(t,d=>{e(f)?d(k):d(M,!1)},r)}};h(Z,t=>{e(C)?t(ee):t(ae,!1)})}n(L);var te=l(L,2);{var re=t=>{De(t,{get id(){return e(a).id},get drawing_id(){return e(a).drawing_id},onClose:H})};h(te,t=>{e(y)&&e(a)&&t(re)})}w(O,j),fe(),X()}export{Qe as component};
