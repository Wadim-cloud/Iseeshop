import{t as f,a as n,b as Oe}from"../chunks/fM_HHR7z.js";import{i as tt}from"../chunks/Dcs68N15.js";import{p as rt,o as at,au as Ae,av as st,a as ot,aw as it,ar as a,as as r,af as k,x as e,I as V,A as b,at as t,aq as T,w as Z,ap as lt}from"../chunks/Cw_GAJ-8.js";import{h as ct,e as H,s as u}from"../chunks/tsz7uQk5.js";import{i as J}from"../chunks/JX9NnDbc.js";import{e as he,i as qe}from"../chunks/C5uFXPOK.js";import{s as Me,r as W}from"../chunks/5A2ZYZT-.js";import{s as vt}from"../chunks/B3wL8fD2.js";import{s as dt}from"../chunks/DrJ5GnEB.js";import{b as X}from"../chunks/BlA1OJav.js";import{p as nt}from"../chunks/Bfc47y5P.js";import{s as ut,a as Be}from"../chunks/BbjLjIkL.js";import{c as Ye,a as we,b as mt}from"../chunks/BYbTja4Y.js";import{s as ye}from"../chunks/CI_hdHvm.js";import{g as pt}from"../chunks/DV9TUGiz.js";import{g as De}from"../chunks/BsK15QRw.js";const _t=[{id:"mug",name:"Coffee Mug",price:19.99},{id:"tshirt",name:"T-Shirt",price:24.99},{id:"poster",name:"Poster",price:14.99},{id:"phonecase",name:"Phone Case",price:29.99},{id:"pillow",name:"Throw Pillow",price:34.99}];async function ft(C){try{const S=pt(Ye);if(!S||S.length===0)return{success:!1,error:"Cart is empty"};const ie=S.map(l=>{const o=_t.find(te=>te.id===l.selected3DObject);if(!o)throw new Error(`Invalid 3D object selected for drawing ${l.drawingId}`);return{drawingId:l.drawingId,price:o.price,selected3DObject:l.selected3DObject}}),xe=ie.reduce((l,o)=>l+o.price,0),{data:p,error:_e}=await ye.from("orders").insert({buyer_name:C.name,buyer_email:C.email,buyer_address:C.address,buyer_city:C.city,buyer_state:C.state,buyer_zip:C.zipCode,buyer_country:C.country,total_amount:xe,status:"pending",order_date:new Date().toISOString()}).select("id").single();if(_e||!p)return console.error("Error creating order:",_e),{success:!1,error:"Failed to create order"};const K=p.id,ee=ie.map(l=>({order_id:K,drawing_id:l.drawingId,price:l.price,selected_3d_object:l.selected3DObject||null})),{error:I}=await ye.from("order_items").insert(ee);if(I)return console.error("Error creating order items:",I),await ye.from("orders").delete().eq("id",K),{success:!1,error:"Failed to create order items"};const{error:v}=await ye.from("orders").update({status:"completed"}).eq("id",K);return v&&console.error("Error updating order status:",v),we.clearCart(),{success:!0,orderId:K}}catch(S){return console.error("Checkout error:",S),{success:!1,error:S instanceof Error?S.message:"An unexpected error occurred during checkout"}}}var gt=f('<meta name="description" content="Complete your order">'),bt=f('<div class="empty-checkout svelte-umoqr3"><p>Your cart is empty.</p> <button class="back-button svelte-umoqr3">Return to Gallery</button></div>'),ht=f('<div><div class="object-image svelte-umoqr3"><div class="object-placeholder svelte-umoqr3"><span> </span></div></div> <div class="object-info svelte-umoqr3"><span class="object-name svelte-umoqr3"> </span> <span class="object-price svelte-umoqr3"> </span></div></div>'),qt=f('<div class="mock-3d-object svelte-umoqr3"><span> </span> <div class="texture-overlay svelte-umoqr3"></div></div>'),yt=f('<div class="checkout-item svelte-umoqr3"><div class="item-image svelte-umoqr3"><img alt="Drawing preview" class="svelte-umoqr3"> <button class="remove-button svelte-umoqr3"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M18 6L6 18M6 6l12 12"></path></svg></button></div> <div class="item-options svelte-umoqr3"><h3>Select 3D Object</h3> <div class="objects-grid svelte-umoqr3"></div> <div class="preview-section svelte-umoqr3"><h4>Preview</h4> <div class="preview-3d svelte-umoqr3"><div class="preview-placeholder svelte-umoqr3"><!></div></div></div></div></div>'),wt=f('<div class="summary-item svelte-umoqr3"><span> </span> <span> </span></div>'),xt=f('<div class="checkout-content svelte-umoqr3"><div class="checkout-items svelte-umoqr3"></div> <div class="checkout-summary svelte-umoqr3"><h2 class="svelte-umoqr3">Order Summary</h2> <div class="summary-items svelte-umoqr3"></div> <div class="summary-total svelte-umoqr3"><span>Total</span> <span> </span></div> <div class="checkout-actions svelte-umoqr3"><button class="back-button svelte-umoqr3">Continue Shopping</button> <button class="checkout-button svelte-umoqr3">Continue to Shipping</button></div></div></div>'),jt=f('<div class="summary-item svelte-umoqr3"><img alt="Drawing preview" class="item-thumbnail svelte-umoqr3"> <div class="item-details svelte-umoqr3"><span class="item-id svelte-umoqr3"> </span> <span class="item-price"> </span></div></div>'),kt=f('<div class="error-message svelte-umoqr3"> </div>'),Ct=f('<div class="cart-summary svelte-umoqr3"><h2 class="svelte-umoqr3">Order Summary</h2> <div class="summary-items svelte-umoqr3"></div> <div class="summary-total svelte-umoqr3"><span> </span> <span class="total-amount svelte-umoqr3"> </span></div></div> <div class="checkout-form svelte-umoqr3"><h2 class="svelte-umoqr3">Shipping Information</h2> <!> <form><div class="form-group svelte-umoqr3"><label for="name" class="svelte-umoqr3">Full Name</label> <input type="text" id="name" required class="svelte-umoqr3"></div> <div class="form-group svelte-umoqr3"><label for="email" class="svelte-umoqr3">Email Address</label> <input type="email" id="email" required class="svelte-umoqr3"></div> <div class="form-group svelte-umoqr3"><label for="address" class="svelte-umoqr3">Street Address</label> <input type="text" id="address" required class="svelte-umoqr3"></div> <div class="form-row svelte-umoqr3"><div class="form-group svelte-umoqr3"><label for="city" class="svelte-umoqr3">City</label> <input type="text" id="city" required class="svelte-umoqr3"></div> <div class="form-group svelte-umoqr3"><label for="state" class="svelte-umoqr3">State/Province</label> <input type="text" id="state" required class="svelte-umoqr3"></div></div> <div class="form-row svelte-umoqr3"><div class="form-group svelte-umoqr3"><label for="zipCode" class="svelte-umoqr3">Zip/Postal Code</label> <input type="text" id="zipCode" required class="svelte-umoqr3"></div> <div class="form-group svelte-umoqr3"><label for="country" class="svelte-umoqr3">Country</label> <input type="text" id="country" required class="svelte-umoqr3"></div></div> <div class="form-actions svelte-umoqr3"><button type="button" class="secondary-button svelte-umoqr3">Back to Products</button> <button type="submit" class="primary-button svelte-umoqr3"> </button></div></form></div>',1),St=f('<div class="success-message svelte-umoqr3"><svg viewBox="0 0 24 24" width="48" height="48" fill="none" stroke="#4CAF50" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><path d="M22 4 12 14.01l-3-3"></path></svg> <h2 class="svelte-umoqr3">Purchase Complete!</h2> <p> </p> <p>You will receive a confirmation email shortly.</p> <button class="primary-button svelte-umoqr3">Back to Gallery</button></div>'),It=f('<div class="checkout-container svelte-umoqr3"><h1 class="svelte-umoqr3"><!></h1> <!></div>');function Vt(C,S){rt(S,!1);const[ie,xe]=ut(),p=()=>Be(Ye,"$cartStore",ie),_e=()=>Be(mt,"$cartSize",ie),K=V(),ee=V(),I=[{id:"mug",name:"Coffee Mug",price:19.99,image:"/images/objects/mug.jpg"},{id:"tshirt",name:"T-Shirt",price:24.99,image:"/images/objects/tshirt.jpg"},{id:"poster",name:"Poster",price:14.99,image:"/images/objects/poster.jpg"},{id:"phonecase",name:"Phone Case",price:29.99,image:"/images/objects/phonecase.jpg"},{id:"pillow",name:"Throw Pillow",price:34.99,image:"/images/objects/pillow.jpg"}];let v=V({}),l=V("product-selection"),o=V({name:"",email:"",address:"",city:"",state:"",zipCode:"",country:""}),te=V(!1),le=V(null),$e=V();at(()=>{p().length>0?(p().forEach(s=>{s.selected3DObject?k(v,e(v)[s.drawingId]=s.selected3DObject):k(v,e(v)[s.drawingId]=I[0].id)}),Object.entries(e(v)).forEach(([s,c])=>{we.updateCartItem(parseInt(s),{selected3DObject:c})})):De("/gallery")});function Ge(s,c){k(v,e(v)[s]=c),we.updateCartItem(s,{selected3DObject:c})}function Le(s){we.removeFromCart(s),delete e(v)[s],p().length===0&&De("/gallery")}function Ne(){let s=0;return p().forEach(c=>{const Q=e(v)[c.drawingId],re=I.find(d=>d.id===Q);re&&(s+=re.price)}),s}function Re(){b(l,"shipping-info")}async function Ve(){b(te,!0),b(le,null);try{const s=await ft(e(o));s.success?(b(l,"success"),b($e,s.orderId)):b(le,s.error||"Purchase failed")}catch(s){b(le,s instanceof Error?s.message:"An unexpected error occurred")}finally{b(te,!1)}}function Ze(){b(l,"product-selection")}function je(){De("/gallery")}Ae(()=>p(),()=>{b(K,p().length===0)}),Ae(()=>{},()=>{b(ee,Ne())}),st(),tt();var ke=It();ct(s=>{var c=gt();it.title="Checkout | Pexos",n(s,c)});var Ce=r(ke),He=r(Ce);{var Je=s=>{var c=Oe("Your Custom 3D Order");n(s,c)},Ke=(s,c)=>{{var Q=d=>{var O=Oe("Shipping Information");n(d,O)},re=d=>{var O=Oe("Order Complete");n(d,O)};J(s,d=>{e(l)==="shipping-info"?d(Q):d(re,!1)},c)}};J(He,s=>{e(l)==="product-selection"?s(Je):s(Ke,!1)})}t(Ce);var Qe=a(Ce,2);{var Ue=s=>{var c=bt(),Q=a(r(c),2);t(c),H("click",Q,je),n(s,c)},We=(s,c)=>{{var Q=d=>{var O=xt(),ce=r(O);he(ce,5,p,qe,(y,g)=>{var w=yt(),P=r(w),B=r(P),U=a(B,2);t(P);var E=a(P,2),Y=a(r(E),2);he(Y,5,()=>I,qe,(F,_)=>{var x=ht(),j=r(x),L=r(j),N=r(L),z=r(N,!0);t(N),t(L),t(j);var ne=a(j,2),se=r(ne),be=r(se,!0);t(se);var ue=a(se,2),me=r(ue);t(ue),t(ne),t(x),T(Se=>{vt(x,1,`object-option ${e(v)[e(g).drawingId]===e(_).id?"selected":""}`,"svelte-umoqr3"),u(z,e(_).name),u(be,e(_).name),u(me,`$${Se??""}`)},[()=>e(_).price.toFixed(2)],Z),H("click",x,()=>Ge(e(g).drawingId,e(_).id)),n(F,x)}),t(Y);var m=a(Y,2),G=a(r(m),2),ae=r(G),ge=r(ae);{var de=F=>{var _=qt();const x=Z(()=>I.find(z=>z.id===e(v)[e(g).drawingId]));var j=r(_),L=r(j,!0);t(j);var N=a(j,2);t(_),T(()=>{var z;u(L,((z=e(x))==null?void 0:z.name)||"Object"),dt(N,`background-image: url(${e(g).imageData??""})`)}),n(F,_)};J(ge,F=>{e(v)[e(g).drawingId]&&F(de)})}t(ae),t(G),t(m),t(E),t(w),T(()=>Me(B,"src",e(g).imageData)),H("click",U,()=>Le(e(g).drawingId)),n(y,w)}),t(ce);var fe=a(ce,2),h=a(r(fe),2);he(h,5,p,qe,(y,g)=>{var w=wt();const P=Z(()=>I.find(m=>m.id===e(v)[e(g).drawingId]));var B=r(w),U=r(B,!0);t(B);var E=a(B,2),Y=r(E);t(E),t(w),T(m=>{var G;u(U,((G=e(P))==null?void 0:G.name)||"Custom Object"),u(Y,`$${m??""}`)},[()=>{var m;return((m=e(P))==null?void 0:m.price.toFixed(2))||"0.00"}],Z),n(y,w)}),t(h);var A=a(h,2),M=a(r(A),2),D=r(M);t(M),t(A);var $=a(A,2),q=r($),ve=a(q,2);t($),t(fe),t(O),T(y=>u(D,`$${y??""}`),[()=>e(ee).toFixed(2)],Z),H("click",q,je),H("click",ve,Re),n(d,O)},re=(d,O)=>{{var ce=h=>{var A=Ct(),M=lt(A),D=a(r(M),2);he(D,5,p,qe,(i,R)=>{var pe=jt();const Pe=Z(()=>I.find(oe=>oe.id===e(v)[e(R).drawingId]));var Ee=r(pe),Fe=a(Ee,2),Ie=r(Fe),Xe=r(Ie,!0);t(Ie);var ze=a(Ie,2),et=r(ze);t(ze),t(Fe),t(pe),T(oe=>{var Te;Me(Ee,"src",e(R).imageData),u(Xe,((Te=e(Pe))==null?void 0:Te.name)||"Custom Object"),u(et,`$${oe??""}`)},[()=>{var oe;return((oe=e(Pe))==null?void 0:oe.price.toFixed(2))||"0.00"}],Z),n(i,pe)}),t(D);var $=a(D,2),q=r($),ve=r(q);t(q);var y=a(q,2),g=r(y);t(y),t($),t(M);var w=a(M,2),P=a(r(w),2);{var B=i=>{var R=kt(),pe=r(R,!0);t(R),T(()=>u(pe,e(le))),n(i,R)};J(P,i=>{e(le)&&i(B)})}var U=a(P,2),E=r(U),Y=a(r(E),2);W(Y),t(E);var m=a(E,2),G=a(r(m),2);W(G),t(m);var ae=a(m,2),ge=a(r(ae),2);W(ge),t(ae);var de=a(ae,2),F=r(de),_=a(r(F),2);W(_),t(F);var x=a(F,2),j=a(r(x),2);W(j),t(x),t(de);var L=a(de,2),N=r(L),z=a(r(N),2);W(z),t(N);var ne=a(N,2),se=a(r(ne),2);W(se),t(ne),t(L);var be=a(L,2),ue=r(be),me=a(ue,2),Se=r(me,!0);t(me),t(be),t(U),t(w),T((i,R)=>{u(ve,`Total (${_e()??""} items):`),u(g,`$${i??""}`),me.disabled=e(te),u(Se,R)},[()=>e(ee).toFixed(2),()=>e(te)?"Processing...":`Complete Purchase - $${e(ee).toFixed(2)}`],Z),X(Y,()=>e(o).name,i=>k(o,e(o).name=i)),X(G,()=>e(o).email,i=>k(o,e(o).email=i)),X(ge,()=>e(o).address,i=>k(o,e(o).address=i)),X(_,()=>e(o).city,i=>k(o,e(o).city=i)),X(j,()=>e(o).state,i=>k(o,e(o).state=i)),X(z,()=>e(o).zipCode,i=>k(o,e(o).zipCode=i)),X(se,()=>e(o).country,i=>k(o,e(o).country=i)),H("click",ue,Ze),H("submit",U,nt(Ve)),n(h,A)},fe=(h,A)=>{{var M=D=>{var $=St(),q=a(r($),4),ve=r(q);t(q);var y=a(q,4);t($),T(()=>u(ve,`Your order (#${e($e)??""}) has been successfully placed.`)),H("click",y,je),n(D,$)};J(h,D=>{e(l)==="success"&&D(M)},A)}};J(d,h=>{e(l)==="shipping-info"?h(ce):h(fe,!1)},O)}};J(s,d=>{e(l)==="product-selection"?d(Q):d(re,!1)},c)}};J(Qe,s=>{e(K)?s(Ue):s(We,!1)})}t(ke),n(C,ke),ot(),xe()}export{Vt as component};
