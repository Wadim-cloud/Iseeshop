import"../chunks/CWj6FrbW.js";import"../chunks/69_IOA4Y.js";import{p as xe,G as B,x as e,o as ge,al as he,am as we,ao as Z,a as ke,ap as u,ar as m,w as I,A as w,as as b}from"../chunks/9BOlcS-b.js";import{e as z,s as J}from"../chunks/BsZz1DC-.js";import{e as _e,i as ye}from"../chunks/DhNq3B23.js";import{t as oe,a as K}from"../chunks/Bnw62dMu.js";import{r as Y,a as Se,s as C,b as Le}from"../chunks/CTf98LKf.js";import{s as je}from"../chunks/Cb2afnRg.js";import{b as Ae}from"../chunks/9x1-h8O0.js";import{b as Me}from"../chunks/trMeve9e.js";import{i as De}from"../chunks/xvq0-Hdq.js";import{g as ze,c as Ee,h as Be,W as Ue,A as Ce,D as Re,G as Ve,V as E,e as O,i as Q,j as ee,k as $e,d as Fe}from"../chunks/Db2sCihH.js";import{S as te}from"../chunks/BjVaaCQb.js";var Ge=oe('<div><div class="model-header svelte-1xiknbp"><input type="checkbox"> <span class="svelte-1xiknbp"> </span></div> <div class="model-controls svelte-1xiknbp"><div class="file-upload svelte-1xiknbp"><label class="svelte-1xiknbp">Upload STL</label> <input type="file" accept=".stl" class="svelte-1xiknbp"></div> <div class="file-upload svelte-1xiknbp"><label class="svelte-1xiknbp">Upload Texture</label> <input type="file" accept="image/*" class="svelte-1xiknbp"></div> <div class="color-picker svelte-1xiknbp"><span>Color:</span> <input type="color"></div></div></div>'),Te=oe('<main><div class="app-container svelte-1xiknbp"><div class="sidebar svelte-1xiknbp"><h2 class="svelte-1xiknbp">STL Viewer</h2> <div class="models-section svelte-1xiknbp"><h3 class="svelte-1xiknbp">Models</h3> <!></div> <div class="scene-controls svelte-1xiknbp"><h3 class="svelte-1xiknbp">Controls</h3> <div class="control-group svelte-1xiknbp"><label for="zoom-level">Zoom Level</label> <input type="range" id="zoom-level" min="0" max="100" step="1" class="svelte-1xiknbp"> <span> </span></div> <button class="svelte-1xiknbp">Reset Camera</button> <button class="svelte-1xiknbp">Export as PNG</button></div></div> <div class="canvas-container svelte-1xiknbp"><canvas class="svelte-1xiknbp"></canvas></div></div></main>');function et(ae,se){xe(se,!1);let c=B([{id:1,name:"Model 1",file:null,object:null,color:"#ff0000",texture:null,position:[0,0,0],visible:!0,path:"/models/Dobbelsteen.stl"},{id:2,name:"Model 2",file:null,object:null,color:"#00ff00",texture:null,position:[3,0,0],visible:!0,path:"/models/test.stl"},{id:3,name:"Model 3",file:null,object:null,color:"#0000ff",texture:null,position:[-3,0,0],visible:!0,path:"/models/tshirt.stl"}]),X=B(e(c)[0]),S=B(50),k=B(),g,d=B(),A,n=B(),R=!1,U={x:0,y:0};ge(async()=>{g=new ze,g.background=new Ee("#e0e0e0"),w(d,new Be(50,600/400,.1,1e4)),e(d).position.set(10,10,20),e(d).lookAt(0,0,0),A=new Ue({canvas:e(k),antialias:!0,preserveDrawingBuffer:!0}),A.setSize(600,400),A.shadowMap.enabled=!0;const r=new Ce(16777215,.5);g.add(r);const t=new Re(16777215,1);t.position.set(5,10,7),t.castShadow=!0,g.add(t);const i=new Ve(20,20,8947848,4473924);g.add(i),w(n,{target:new E(0,0,0),minDistance:5,maxDistance:50,zoomSpeed:1,rotateSpeed:.05,panSpeed:.1});const a=o=>{R=!0,U={x:o.clientX,y:o.clientY}},h=o=>{if(!R)return;const p=o.clientX-U.x,_=o.clientY-U.y;if(o.buttons===1){const s=_*e(n).rotateSpeed,L=p*e(n).rotateSpeed,f=e(d).position.clone().sub(e(n).target),j=f.length();f.applyAxisAngle(new E(0,1,0),-L);const y=new E().crossVectors(f,new E(0,1,0)).normalize();f.applyAxisAngle(y,-s),e(d).position.copy(e(n).target).add(f.normalize().multiplyScalar(j)),e(d).lookAt(e(n).target)}else if(o.buttons===2){const s=new E(-p*e(n).panSpeed,_*e(n).panSpeed,0);e(n).target.add(s),e(d).position.add(s),e(d).lookAt(e(n).target)}U={x:o.clientX,y:o.clientY}},v=()=>{R=!1},M=o=>{o.preventDefault();const p=o.deltaY>0?-1:1;w(S,Math.max(0,Math.min(100,e(S)+p*e(n).zoomSpeed)))};e(k).addEventListener("mousedown",a),e(k).addEventListener("mousemove",h),e(k).addEventListener("mouseup",v),e(k).addEventListener("wheel",M,{passive:!1});const l=new te;for(const o of e(c))if(o.path)try{console.log(`Loading model: ${o.name}`);const p=await fetch(o.path);if(!p.ok)throw new Error(`Failed to fetch ${o.path}`);const _=await p.arrayBuffer(),s=l.parse(_);if(s.center(),!s.attributes.uv){s.computeVertexNormals(),s.computeBoundingBox();const f=s.boundingBox,j=new E;f.getSize(j);const y=new Float32Array(s.attributes.position.count*2);for(let x=0;x<s.attributes.position.count;x++){const be=s.attributes.position.array[x*3],fe=s.attributes.position.array[x*3+1];y[x*2]=(be-f.min.x)/j.x,y[x*2+1]=(fe-f.min.y)/j.y}s.setAttribute("uv",new O(y,2))}const L=new Q({color:o.color,roughness:.7,metalness:.2,map:null});o.object=new ee(s,L),o.object.position.set(...o.position),o.object.castShadow=!0,o.object.receiveShadow=!0,o.visible&&g.add(o.object),w(c,[...e(c)]),console.log(`Successfully loaded model: ${o.name}`)}catch(p){console.error(`Error loading model ${o.name}:`,p)}const D=()=>{requestAnimationFrame(D),A.render(g,e(d))};return D(),()=>{e(k).removeEventListener("mousedown",a),e(k).removeEventListener("mousemove",h),e(k).removeEventListener("mouseup",v),e(k).removeEventListener("wheel",M),A.dispose()}});function ie(r,t){const i=r.target.files[0];if(!i)return;const a=e(c).find(v=>v.id===t);if(!a)return;const h=new FileReader;h.onload=v=>{const l=new te().parse(v.target.result);if(l.center(),!l.attributes.uv){l.computeVertexNormals(),l.computeBoundingBox();const o=l.boundingBox,p=new E;o.getSize(p);const _=new Float32Array(l.attributes.position.count*2);for(let s=0;s<l.attributes.position.count;s++){const L=l.attributes.position.array[s*3],f=l.attributes.position.array[s*3+1];_[s*2]=(L-o.min.x)/p.x,_[s*2+1]=(f-o.min.y)/p.y}l.setAttribute("uv",new O(_,2))}a.object&&g.remove(a.object);const D=new Q({color:a.color,roughness:.7,metalness:.2,map:a.texture?a.texture:null});a.object=new ee(l,D),a.object.position.set(...a.position),a.object.castShadow=!0,a.object.receiveShadow=!0,a.visible&&g.add(a.object),a.file=i,w(c,[...e(c)])},h.readAsArrayBuffer(i)}function ne(r,t){const i=r.target.files[0];if(!i)return;const a=e(c).find(v=>v.id===t);if(!a||!a.object)return;const h=new FileReader;h.onload=v=>{const l=new $e().load(v.target.result);l.colorSpace=Fe,a.texture=l,a.object.material.map=l,a.object.material.needsUpdate=!0,w(c,[...e(c)])},h.readAsDataURL(i)}function re(r,t){const i=e(c).find(a=>a.id===r);i&&i.object&&(i.color=t,i.object.material.color.set(t),i.object.material.needsUpdate=!0,w(c,[...e(c)]))}function le(r){const t=e(c).find(i=>i.id===r);t&&t.object&&(t.visible=!t.visible,t.visible?g.add(t.object):g.remove(t.object),w(c,[...e(c)]))}function ce(){w(S,50),e(d).position.set(10,10,20),e(n).target.set(0,0,0),e(d).lookAt(e(n).target)}function de(){A.render(g,e(d));const r=A.domElement.toDataURL("image/png"),t=document.createElement("a");t.href=r,t.download="viewport-snapshot.png",t.click()}he(()=>(e(d),e(n),e(S)),()=>{if(e(d)&&e(n)){const r=e(n).minDistance+(e(n).maxDistance-e(n).minDistance)*(e(S)/100),t=e(d).position.clone().sub(e(n).target).normalize();e(d).position.copy(e(n).target).add(t.multiplyScalar(r)),e(d).lookAt(e(n).target)}}),we(),De();var V=Te(),N=m(V),$=m(N),F=u(m($),2),pe=u(m(F),2);_e(pe,1,()=>e(c),ye,(r,t)=>{var i=Ge();let a;var h=m(i),v=m(h);Y(v);var M=u(v,2),l=m(M,!0);b(M),b(h);var D=u(h,2),o=m(D),p=m(o),_=u(p,2);b(o);var s=u(o,2),L=m(s),f=u(L,2);b(s);var j=u(s,2),y=u(m(j),2);Y(y),b(j),b(D),b(i),Z(x=>{a=je(i,1,"model-item svelte-1xiknbp",null,a,x),Se(v,e(t).visible),J(l,e(t).name),C(p,"for",`file-${e(t).id}`),C(_,"id",`file-${e(t).id}`),C(L,"for",`texture-${e(t).id}`),C(f,"id",`texture-${e(t).id}`),Le(y,e(t).color)},[()=>({selected:e(X).id===e(t).id})],I),z("change",v,()=>le(e(t).id)),z("change",_,x=>ie(x,e(t).id)),z("change",f,x=>ne(x,e(t).id)),z("input",y,x=>re(e(t).id,x.target.value)),z("click",i,()=>w(X,e(t))),K(r,i)}),b(F);var P=u(F,2),G=u(m(P),2),T=u(m(G),2);Y(T);var W=u(T,2),ue=m(W,!0);b(W),b(G);var q=u(G,2),ve=u(q,2);b(P),b($);var H=u($,2),me=m(H);Me(me,r=>w(k,r),()=>e(k)),b(H),b(N),b(V),Z(r=>J(ue,r),[()=>Math.round(e(S))],I),Ae(T,()=>e(S),r=>w(S,r)),z("click",q,ce),z("click",ve,de),K(ae,V),ke()}export{et as component};
