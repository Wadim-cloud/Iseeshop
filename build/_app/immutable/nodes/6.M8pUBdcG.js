import"../chunks/CWj6FrbW.js";import"../chunks/69_IOA4Y.js";import{p as ee,aB as Se,at as h,ar as D,au as m,aq as Q,w as xe,x as t,G as Y,a as te,A as M,o as be,ap as se,am as Te,an as Ce,ak as he,al as re,ao as Be,az as We,as as Fe}from"../chunks/CgpLTG9e.js";import{s as J,e as x,h as Oe}from"../chunks/C_m-qMmZ.js";import{t as A,a as L,c as ue}from"../chunks/CVxkZOGS.js";import{g as Re}from"../chunks/CRvbaXOV.js";import{i as ae}from"../chunks/CKI-jMsq.js";import{a as N,s as _e}from"../chunks/CN5En7F1.js";import{i as U}from"../chunks/ClXQIVwo.js";import{e as we,i as Pe}from"../chunks/B6FZq7_G.js";import{p as I}from"../chunks/Bxv1m9ax.js";import{s as ie}from"../chunks/CvOifuop.js";import{s as De}from"../chunks/CZQXRoan.js";import{s as qe}from"../chunks/Bfc47y5P.js";import{l as ve,c as pe,a as Ae,b as Ze}from"../chunks/CyNihBcV.js";import{s as je}from"../chunks/B9RedXCH.js";import{t as ge,f as ze,a as He,s as Ue}from"../chunks/sPbp32sz.js";import{b as me}from"../chunks/Bs1xm8oX.js";import{k as Me,l as de,g as Ye,h as Ve,W as Ne,c as Ke,A as $e,D as Ee,V as ke,f as Je,j as Qe}from"../chunks/Db2sCihH.js";import{S as Xe}from"../chunks/BjVaaCQb.js";import{O as et}from"../chunks/bDxDMfUK.js";import{C as tt}from"../chunks/ChY03eKQ.js";import{w as le}from"../chunks/4hlrb4d8.js";import{s as ye}from"../chunks/BEUgLf7p.js";var at=A('<div class="gallery-item svelte-huzhr6"><div class="image-container svelte-huzhr6"><img class="gallery-image svelte-huzhr6" loading="lazy"> <button class="like-button-overlay svelte-huzhr6"><svg width="24" height="24" viewBox="0 0 24 24" stroke-width="2"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path></svg> <span class="like-count svelte-huzhr6"> </span></button></div> <div class="gallery-content svelte-huzhr6"><div class="drawing-info svelte-huzhr6"><h3 class="drawing-title svelte-huzhr6"> </h3> <p class="drawing-date svelte-huzhr6"> </p></div> <div class="action-buttons svelte-huzhr6"><div class="button-row svelte-huzhr6"><button class="action-button preview-button svelte-huzhr6"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg> <span>Preview</span></button> <button class="action-button preview-3d svelte-huzhr6"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path><path d="M12 18a6 6 0 100-12 6 6 0 000 12z"></path><path d="M12 14a2 2 0 100-4 2 2 0 000 4z"></path></svg> <span>3D View</span></button></div> <div class="button-row svelte-huzhr6"><button class="action-button comments-button svelte-huzhr6"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 11.5a8.38 8.38 0 01-.9 3.8 8.5 8.5 0 01-7.6 4.7 8.38 8.38 0 01-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 01-.9-3.8 8.5 8.5 0 014.7-7.6 8.38 8.38 0 013.8-.9h.5a8.48 8.48 0 018 8v.5z"></path></svg> <span> </span></button> <button><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 20a1 1 0 100-2 1 1 0 000 2z"></path><path d="M20 20a1 1 0 100-2 1 1 0 000 2z"></path><path d="M1 1h4l2.68 13.39a2 2 0 002 1.61h9.72a2 2 0 002-1.61L23 6H6"></path></svg> <span> </span></button></div></div></div></div>');function ot(q,s){ee(s,!1);const[v,l]=_e(),n=()=>N(Ae,"$cartStore",v),z=()=>N(ve,"$likesStore",v);let a=I(s,"drawing",8),C=I(s,"onLike",8),w=I(s,"onPreview",8),o=I(s,"on3DPreview",8),B=I(s,"onOpenComments",8);Se();let p=Y({});function T(G){console.log("handleLike called with drawingId:",G),M(p,{...t(p),[G]:!t(p)[G]}),C()(G)}function b(G){console.log("handlePreview called with imageData:",G),w()(G)}function c(G){console.log("handle3DPreview called with imageData:",G),o()(G)}function i(G,$){console.log("handleOpenComments called with:",{drawingId:G,drawingUuid:$}),B()(G,$)}const y="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2VlZSIvPjx0ZXh0IHg9IjUwIiB5PSI1MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjgiIGZpbGw9IiNjY2MiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiPkxvYWRpbmc8L3RleHQ+PC9zdmc+";function u(G){return n().some($=>$.drawingId===G)}function _(G){console.log("toggleCartItem called with drawingId:",G.drawing_id),u(G.drawing_id)?pe.removeFromCart(G.drawing_id):pe.addToCart(G)}ae();var d=at(),E=h(d),S=h(E);ie(S,"src",y);var g=D(S,2),e=h(g),f=D(e,2),P=h(f,!0);m(f),m(g),m(E);var k=D(E,2),W=h(k),j=h(W),R=h(j,!0);m(j);var r=D(j,2),H=h(r);m(r),m(W);var Z=D(W,2),V=h(Z),F=h(V),O=D(F,2);m(V);var K=D(V,2),ce=h(K),X=D(h(ce),2),ne=h(X);m(X),m(ce);var oe=D(ce,2),fe=D(h(oe),2),Ge=h(fe,!0);m(fe),m(oe),m(K),m(Z),m(k),m(d),Q((G,$,Ie)=>{var Le;ie(S,"data-src",a().image_data),ie(S,"alt",`User drawing ${a().drawing_id}`),ie(e,"fill",t(p)[a().drawing_id]?"#ff4757":"none"),ie(e,"stroke",t(p)[a().drawing_id]?"#ff4757":"#ffffff"),J(P,z()[a().drawing_id]||a().likes||0),J(R,a().drawing_id),J(H,`Created: ${G??""}`),J(ne,`Comments (${(((Le=a().comments)==null?void 0:Le.length)||0)??""})`),De(oe,1,`action-button cart-button ${$??""}`,"svelte-huzhr6"),J(Ge,Ie)},[()=>new Date(a().created_at).toLocaleDateString(),()=>u(a().drawing_id)?"in-cart":"",()=>u(a().drawing_id)?"Remove from Cart":"Add to Cart"],xe),x("click",S,()=>b(a().image_data)),x("load",S,G=>{const $=G.target;$.dataset.src&&($.src=$.dataset.src)}),x("click",g,qe(()=>T(a().drawing_id))),x("click",F,()=>b(a().image_data)),x("click",O,()=>c(a().image_data)),x("click",ce,()=>i(a().drawing_id,a().id)),x("click",oe,()=>_(a())),L(q,d),te(),l()}var rt=A('<div class="preview-modal svelte-1impoal" role="dialog" aria-modal="true" aria-label="Drawing preview"><div class="preview-content svelte-1impoal"><button class="close-button svelte-1impoal" aria-label="Close preview"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>  <div class="controls svelte-1impoal"><button aria-label="Zoom out" class="svelte-1impoal"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="7" y1="11" x2="15" y2="11"></line></svg></button> <button aria-label="Zoom in" class="svelte-1impoal"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="11" y1="7" x2="11" y2="15"></line><line x1="7" y1="11" x2="15" y2="11"></line></svg></button></div> <div class="image-container svelte-1impoal"><img alt="Drawing preview" class="svelte-1impoal"></div></div></div>');function nt(q,s){ee(s,!1);let v=I(s,"imageData",8),l=I(s,"onClose",8),n=Y(),z=Y(),a=Y(1);be(()=>{var c;if(console.log("PreviewModal mounted with imageData:",v()),t(n)){(c=t(z))==null||c.focus();const i=t(n).querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),y=i[0],u=i[i.length-1],_=d=>{d.key==="Tab"&&(d.shiftKey&&document.activeElement===y?(d.preventDefault(),u.focus()):!d.shiftKey&&document.activeElement===u&&(d.preventDefault(),y.focus()))};return t(n).addEventListener("keydown",_),()=>t(n).removeEventListener("keydown",_)}});function C(c){c.key==="Escape"&&l()()}function w(){M(a,Math.min(t(a)+.2,3))}function o(){M(a,Math.max(t(a)-.2,1))}function B(c){c.preventDefault();const i=c.deltaY>0?-.1:.1;M(a,Math.min(Math.max(t(a)+i,1),3))}ae();var p=ue(),T=se(p);{var b=c=>{var i=rt(),y=h(i),u=h(y);me(u,e=>M(z,e),()=>t(z));var _=D(u,2),d=h(_),E=D(d,2);m(_);var S=D(_,2),g=h(S);m(S),m(y),m(i),me(i,e=>M(n,e),()=>t(n)),Q(()=>{ie(g,"src",v()),je(g,`transform: scale(${t(a)??""});`)}),x("click",u,function(...e){var f;(f=l())==null||f.apply(this,e)}),x("keydown",u,e=>(e.key==="Enter"||e.key===" ")&&l()()),x("click",d,o),x("keydown",d,e=>(e.key==="Enter"||e.key===" ")&&o()),x("click",E,w),x("keydown",E,e=>(e.key==="Enter"||e.key===" ")&&w()),ge(3,g,()=>ze,()=>({duration:100})),x("error",g,()=>console.error("Image load error:",v())),x("keydown",i,C),x("wheel",i,B),ge(3,i,()=>ze,()=>({duration:200})),L(c,i)};U(T,c=>{v()&&c(b)})}L(q,p),te()}var it=A('<p class="error-message svelte-1hfv2po">Error loading 3D model.</p>'),lt=A('<p class="loading-message svelte-1hfv2po">Loading texture...</p>'),st=A('<p class="error-message svelte-1hfv2po">Error loading texture.</p>'),ct=A('<div class="model-container svelte-1hfv2po"><!></div>');function dt(q,s){ee(s,!1);let v=I(s,"drawingData",8),l=I(s,"zoomLevel",8,1),n=Y(),z,a,C=Y(),w,o=Y(),B,p=Y(!1),T=Y(!1),b=Y(!1);function c(){z=new Ye,a=new Ve(75,1,.1,1e3),M(C,new Ne({antialias:!0,alpha:!0})),t(C).setSize(t(n).clientWidth,t(n).clientHeight),z.background=new Ke(16777215),t(n).appendChild(t(C).domElement),a.position.z=8,w=new et(a,t(C).domElement),w.enableZoom=!0,w.enablePan=!1,w.minPolarAngle=Math.PI/2,w.maxPolarAngle=Math.PI/2,w.enableDamping=!0,w.dampingFactor=.05,w.autoRotate=!0,w.autoRotateSpeed=.1,w.minDistance=3,w.maxDistance=15;const g=new $e(16777215,.5);z.add(g);const e=new Ee(16777215,.7);e.position.set(1,1,1).normalize(),z.add(e);const f=new Ee(16777215,.3);f.position.set(-1,-1,-1).normalize(),z.add(f)}function i(){console.log("Loading T-shirt model with drawingData:",v()),new Xe().load("/models/tshirt.stl",e=>{console.log("STL model loaded successfully"),e.computeBoundingBox();const f=e.boundingBox,P=new ke;f.getSize(P);const k=e.getAttribute("position"),W=[],j=k.array;for(let F=0;F<j.length;F+=3){const O=j[F],K=j[F+1];W.push((O-f.min.x)/P.x,(K-f.min.y)/P.y)}console.log("Generated UVs sample:",W.slice(0,10)),e.setAttribute("uv",new Je(W,2));let R;if(v()){M(p,!0);const F=new Me;console.log("Attempting to load texture:",v()),F.load(v(),O=>{console.log("Texture loaded successfully"),O.flipY=!1,O.anisotropy=t(C).capabilities.getMaxAnisotropy(),R=new de({map:O,color:16777215,specular:1118481,shininess:30}),t(o)&&(re(o,t(o).material=R),re(o,t(o).material.needsUpdate=!0)),M(p,!1)},O=>{console.log("Texture loading progress:",O.loaded/O.total)},O=>{console.error("Texture load error:",O),M(T,!0),M(p,!1),R=new de({color:16777215}),t(o)&&(re(o,t(o).material=R),re(o,t(o).material.needsUpdate=!0))})}else console.warn("No drawingData provided, using default material"),R=new de({color:16777215,specular:1118481,shininess:30});M(o,new Qe(e,R)),e.computeBoundingBox();const r=new ke;f.getCenter(r),t(o).position.sub(r),t(o).scale.set(l(),l(),l()),z.add(t(o));const H=e.boundingBox,Z=new ke;H.getSize(Z);const V=Math.max(Z.x,Z.y,Z.z);(V>10||V<.1)&&(a.position.z=Math.max(V*2,8),w.minDistance=a.position.z*.5,w.maxDistance=a.position.z*2),y()},e=>{console.log("Model loading progress:",e.loaded/e.total)},e=>{console.error("STL load error:",e),M(b,!0)})}function y(){B=requestAnimationFrame(y),t(o)&&t(o).scale.set(l(),l(),l()),w.update(),t(C).render(z,a)}function u(){const g=t(n).clientWidth,e=t(n).clientHeight;t(C).setSize(g,e),a.aspect=g/e,a.updateProjectionMatrix()}be(()=>(console.log("TshirtModel mounted with drawingData:",v()),c(),i(),window.addEventListener("resize",u),u(),()=>{var g;window.removeEventListener("resize",u),cancelAnimationFrame(B),t(n)&&t(C).domElement&&t(n).removeChild(t(C).domElement),t(C).dispose(),(g=t(o))!=null&&g.material&&(Array.isArray(t(o).material)?t(o).material.forEach(e=>e.dispose()):t(o).material.dispose())})),Te(()=>{t(o)&&z.remove(t(o))}),Ce(()=>(he(l()),t(o)),()=>{l()&&t(o)&&t(o).scale.set(l(),l(),l())}),Ce(()=>(he(v()),t(o),t(C)),()=>{if(v()&&t(o)){M(p,!0);const g=new Me;console.log("Reactive texture update for drawingData:",v()),g.load(v(),e=>{console.log("Texture updated successfully"),e.flipY=!1,e.anisotropy=t(C).capabilities.getMaxAnisotropy();const f=new de({map:e,color:16777215,specular:1118481,shininess:30});re(o,t(o).material=f),re(o,t(o).material.needsUpdate=!0),M(p,!1)},e=>{console.log("Texture update progress:",e.loaded/e.total)},e=>{console.error("Texture update error:",e),M(T,!0),M(p,!1),re(o,t(o).material=new de({color:16777215})),re(o,t(o).material.needsUpdate=!0)})}}),Be(),ae();var _=ct(),d=h(_);{var E=g=>{var e=it();L(g,e)},S=(g,e)=>{{var f=k=>{var W=lt();L(k,W)},P=(k,W)=>{{var j=R=>{var r=st();L(R,r)};U(k,R=>{t(T)&&R(j)},W)}};U(g,k=>{t(p)?k(f):k(P,!1)},e)}};U(d,g=>{t(b)?g(E):g(S,!1)})}m(_),me(_,g=>M(n,g),()=>t(n)),L(q,_),te()}var vt=A('<div class="preview-modal svelte-kvavg0" role="dialog" aria-modal="true" aria-label="3D T-shirt preview"><div class="preview-content svelte-kvavg0"><button class="close-button svelte-kvavg0" aria-label="Close preview"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button> <div class="controls svelte-kvavg0"><button aria-label="Zoom out" class="svelte-kvavg0"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="7" y1="11" x2="15" y2="11"></line></svg></button> <button aria-label="Zoom in" class="svelte-kvavg0"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="11" y1="7" x2="11" y2="15"></line><line x1="7" y1="11" x2="15" y2="11"></line></svg></button></div> <div class="model-container svelte-kvavg0"><!></div></div></div>');function ut(q,s){ee(s,!1);let v=I(s,"imageData",8),l=I(s,"onClose",8),n=Y(),z=Y(),a=Y(1);be(()=>{var c;if(console.log("TshirtPreviewModal mounted with imageData:",v()),t(n)){(c=t(z))==null||c.focus();const i=t(n).querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),y=i[0],u=i[i.length-1],_=d=>{d.key==="Tab"&&(d.shiftKey&&document.activeElement===y?(d.preventDefault(),u.focus()):!d.shiftKey&&document.activeElement===u&&(d.preventDefault(),y.focus()))};return t(n).addEventListener("keydown",_),()=>t(n).removeEventListener("keydown",_)}});function C(c){c.key==="Escape"&&l()()}function w(){M(a,Math.min(t(a)+.2,3))}function o(){M(a,Math.max(t(a)-.2,1))}function B(c){c.preventDefault();const i=c.deltaY>0?-.1:.1;M(a,Math.min(Math.max(t(a)+i,1),3))}ae();var p=ue(),T=se(p);{var b=c=>{var i=vt(),y=h(i),u=h(y);me(u,e=>M(z,e),()=>t(z));var _=D(u,2),d=h(_),E=D(d,2);m(_);var S=D(_,2),g=h(S);dt(g,{get drawingData(){return v()},get zoomLevel(){return t(a)}}),m(S),m(y),m(i),me(i,e=>M(n,e),()=>t(n)),x("click",u,function(...e){var f;(f=l())==null||f.apply(this,e)}),x("keydown",u,e=>(e.key==="Enter"||e.key===" ")&&l()()),x("click",d,o),x("keydown",d,e=>(e.key==="Enter"||e.key===" ")&&o()),x("click",E,w),x("keydown",E,e=>(e.key==="Enter"||e.key===" ")&&w()),x("keydown",i,C),x("wheel",i,B),ge(3,i,()=>ze,()=>({duration:200})),L(c,i)};U(T,c=>{v()&&c(b)})}L(q,p),te()}var gt=A('<div class="loading svelte-9bc2at">Loading gallery...</div>'),mt=A('<div class="error svelte-9bc2at"> </div>'),ft=A('<div class="no-content svelte-9bc2at">No drawings available.</div>'),ht=A('<div class="gallery-grid svelte-9bc2at"></div>'),wt=A('<div class="gallery-wrapper svelte-9bc2at"><!> <!> <!> <!></div>');function pt(q,s){ee(s,!1);const[v,l]=_e(),n=()=>N(B,"$selectedDrawing",v),z=()=>N(p,"$selected3DDrawing",v);let a=I(s,"drawings",8),C=I(s,"loading",8),w=I(s,"error",8),o=I(s,"onLike",8);I(s,"onPreview",8),I(s,"onOpenComments",8),I(s,"onPageChange",8);const B=le(null),p=le(null);let T=Y(null),b=Y(null);function c(r){console.log("GalleryGrid handlePreview setting selectedDrawing:",r),B.set(r)}function i(){console.log("GalleryGrid handleClosePreview resetting selectedDrawing"),B.set(null)}function y(r){console.log("GalleryGrid handle3DPreview setting selected3DDrawing:",r),p.set(r)}function u(){console.log("GalleryGrid handleClose3DPreview resetting selected3DDrawing"),p.set(null)}function _(r,H){console.log("GalleryGrid handleOpenComments setting IDs:",{drawingId:r,drawingUuid:H}),M(T,H),M(b,r)}function d(){console.log("GalleryGrid handleCloseComments resetting IDs"),M(T,null),M(b,null)}ae();var E=wt(),S=h(E);{var g=r=>{var H=gt();L(r,H)},e=(r,H)=>{{var Z=F=>{var O=mt(),K=h(O,!0);m(O),Q(()=>J(K,w())),L(F,O)},V=(F,O)=>{{var K=X=>{var ne=ft();L(X,ne)},ce=X=>{var ne=ht();we(ne,5,a,oe=>oe.id,(oe,fe)=>{ot(oe,{get drawing(){return t(fe)},get onLike(){return o()},onPreview:c,on3DPreview:y,onOpenComments:_})}),m(ne),L(X,ne)};U(F,X=>{a().length===0?X(K):X(ce,!1)},O)}};U(r,F=>{w()?F(Z):F(V,!1)},H)}};U(S,r=>{C()?r(g):r(e,!1)})}var f=D(S,2);{var P=r=>{nt(r,{get imageData(){return n()},onClose:i})};U(f,r=>{n()&&r(P)})}var k=D(f,2);{var W=r=>{ut(r,{get imageData(){return z()},onClose:u})};U(k,r=>{z()&&r(W)})}var j=D(k,2);{var R=r=>{tt(r,{get id(){return t(T)},get drawing_id(){return t(b)},onClose:d})};U(j,r=>{t(T)&&t(b)&&r(R)})}m(E),L(q,E),te(),l()}var bt=A("<button></button>"),_t=A('<span class="svelte-1hgqvg2">…</span>'),kt=A("<!> <button> </button>",1),yt=A('<nav class="pagination svelte-1hgqvg2"><button aria-label="Previous Page" class="svelte-1hgqvg2">◀ Prev</button> <!> <button aria-label="Next Page" class="svelte-1hgqvg2">Next ▶</button></nav>');function xt(q,s){ee(s,!1);const v=Y();let l=I(s,"currentPage",8,1),n=I(s,"totalPages",8,1);const z=Se(),a=b=>{b>=1&&b<=n()&&b!==l()&&z("pageChange",b)};Ce(()=>(he(n()),he(l())),()=>{M(v,(()=>{if(n()<=7)return Array.from({length:n()},(c,i)=>i+1);const b=new Set;return b.add(1),b.add(n()),l()>1&&b.add(l()-1),b.add(l()),l()<n()&&b.add(l()+1),Array.from(b).sort((c,i)=>c-i)})())}),Be(),ae();var C=yt(),w=h(C),o=D(w,2);{var B=b=>{var c=ue(),i=se(c);we(i,1,()=>Array(n()),Pe,(y,u,_)=>{var d=bt();let E;d.textContent=_+1,Q(S=>E=De(d,1,"svelte-1hgqvg2",null,E,S),[()=>({selected:_+1===l()})],xe),x("click",d,()=>a(_+1)),L(y,d)}),L(b,c)},p=b=>{var c=ue(),i=se(c);we(i,1,()=>t(v),Pe,(y,u,_)=>{var d=kt(),E=se(d);{var S=P=>{var k=_t();L(P,k)};U(E,P=>{_>0&&t(u)-t(v)[_-1]>1&&P(S)})}var g=D(E,2);let e;var f=h(g,!0);m(g),Q(P=>{e=De(g,1,"svelte-1hgqvg2",null,e,P),J(f,t(u))},[()=>({selected:t(u)===l()})],xe),x("click",g,()=>a(t(u))),L(y,d)}),L(b,c)};U(o,b=>{n()<=7?b(B):b(p,!1)})}var T=D(o,2);m(C),Q(()=>{w.disabled=l()===1,T.disabled=l()===n()}),x("click",w,()=>a(l()-1)),x("click",T,()=>a(l()+1)),L(q,C),te()}var Ct=A('<div class="gallery-controls svelte-19aqbvt"><!></div>');function Pt(q,s){ee(s,!1);let v=I(s,"currentPage",8),l=I(s,"totalPages",8),n=I(s,"onPageChange",8);ae();var z=ue(),a=se(z);{var C=w=>{var o=Ct(),B=h(o);xt(B,{get currentPage(){return v()},get totalPages(){return l()},$$events:{pageChange:p=>n()(p.detail)}}),m(o),L(w,o)};U(a,w=>{l()>1&&w(C)})}L(q,z),te()}var Dt=A('<span class="cart-badge svelte-13mh0ai"> </span>'),zt=A('<div class="empty-cart svelte-13mh0ai"><p>Your cart is empty</p> <p class="empty-caption svelte-13mh0ai">Add drawings to create custom 3D objects</p></div>'),Lt=A('<div class="cart-item svelte-13mh0ai"><img alt="Drawing preview" class="cart-thumbnail svelte-13mh0ai"> <button class="remove-button svelte-13mh0ai"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M18 6L6 18M6 6l12 12"></path></svg></button></div>'),Mt=A('<div class="cart-items svelte-13mh0ai"></div> <div class="cart-footer svelte-13mh0ai"><button class="clear-button svelte-13mh0ai">Clear All</button> <button class="checkout-button svelte-13mh0ai"> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M5 12h14M12 5l7 7-7 7"></path></svg></button></div>',1),Et=A('<div class="cart-panel svelte-13mh0ai"><div class="cart-header svelte-13mh0ai"><h3 class="svelte-13mh0ai"> </h3> <button class="close-button svelte-13mh0ai">×</button></div> <!></div>'),St=A('<div class="cart-container svelte-13mh0ai"><button class="cart-button svelte-13mh0ai"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg> <!></button> <!></div>');function Bt(q,s){ee(s,!1);const[v,l]=_e(),n=()=>N(Ze,"$cartSize",v),z=()=>N(Ae,"$cartStore",v);let a=I(s,"showCart",12,!1);function C(){a(!a())}function w(y){pe.removeFromCart(y)}function o(){a(!1),Re("/gallery/checkout")}ae();var B=St(),p=h(B),T=D(h(p),2);{var b=y=>{var u=Dt(),_=h(u,!0);m(u),Q(()=>J(_,n())),L(y,u)};U(T,y=>{n()>0&&y(b)})}m(p);var c=D(p,2);{var i=y=>{var u=Et(),_=h(u),d=h(_),E=h(d);m(d);var S=D(d,2);m(_);var g=D(_,2);{var e=P=>{var k=zt();L(P,k)},f=P=>{var k=Mt(),W=se(k);we(W,5,z,Pe,(Z,V)=>{var F=Lt(),O=h(F),K=D(O,2);m(F),Q(()=>ie(O,"src",t(V).imageData)),x("click",K,()=>w(t(V).drawingId)),ge(3,F,()=>Ue),L(Z,F)}),m(W);var j=D(W,2),R=h(j),r=D(R,2),H=h(r);We(),m(r),m(j),Q(()=>J(H,`Checkout (${n()??""}) `)),x("click",R,function(...Z){var V;(V=pe.clearCart)==null||V.apply(this,Z)}),x("click",r,o),L(P,k)};U(g,P=>{n()===0?P(e):P(f,!1)})}m(u),Q(()=>J(E,`Your Cart (${n()??""})`)),x("click",S,C),ge(3,u,()=>He,()=>({y:-20,duration:200})),L(y,u)};U(c,y=>{a()&&y(i)})}m(B),x("click",p,C),L(q,B),te(),l()}var At=A('<div class="gallery-container svelte-np1y62"><!> <!> <!></div>');function Gt(q,s){ee(s,!1);const[v,l]=_e(),n=()=>N(c,"$pagination",v),z=()=>N(ve,"$likesStore",v),a=()=>N(B,"$drawings",v),C=()=>N(T,"$loading",v),w=()=>N(p,"$error",v),o=()=>N(b,"$showCart",v),B=le([]),p=le(null),T=le(!1),b=le(!1),c=le({currentPage:1,totalPages:1,itemsPerPage:42});async function i(e){T.set(!0),p.set(null);const{itemsPerPage:f}=n(),P=(e-1)*f;try{const{data:k,count:W,error:j}=await ye.from("drawings").select("id, drawing_id, image_data, likes, created_at, user_id, user_email, blocked, title",{count:"exact"}).eq("blocked",!1).order("created_at",{ascending:!1}).range(P,P+f-1);if(j)throw j;const R=await Promise.all((k||[]).map(async r=>{if(console.log("Fetched drawing:",{id:r.id,drawing_id:r.drawing_id,image_data:r.image_data}),r.image_data&&typeof r.image_data=="string"&&r.image_data.startsWith("drawings/")){const{data:H,error:Z}=await ye.storage.from("drawings").createSignedUrl(r.image_data,3600);return Z?(console.error("Signed URL error for drawing",r.id,Z),r):{...r,image_data:H.signedUrl}}return r}));B.set(R),c.update(r=>({...r,currentPage:e,totalPages:Math.ceil((W||0)/f)})),ve.update(r=>{const H={...r};return R.forEach(Z=>H[Z.drawing_id]=Z.likes),H})}catch(k){p.set(k instanceof Error?k.message:"Failed to load drawings"),console.error("Gallery error:",k)}finally{T.set(!1)}}async function y(e){console.log("GalleryContainer handleLike called with drawingId:",e);const f=z()[e]||0;ve.update(P=>({...P,[e]:f+1})),B.update(P=>P.map(k=>k.drawing_id===e?{...k,likes:f+1}:k));try{await ye.from("drawings").update({likes:f+1}).eq("drawing_id",e).throwOnError()}catch(P){console.error("Like update failed:",P),ve.update(k=>({...k,[e]:f})),B.update(k=>k.map(W=>W.drawing_id===e?{...W,likes:f}:W)),p.set("Failed to update like. Please try again.")}}function u(e){console.log("Preview image:",e)}function _(e,f){console.log("Open comments for:",{drawingId:e,drawingUuid:f})}be(()=>{i(1)}),ae();var d=At(),E=h(d);pt(E,{get drawings(){return a()},get loading(){return C()},get error(){return w()},onLike:y,onPreview:u,onOpenComments:_,onPageChange:i});var S=D(E,2);Pt(S,{get currentPage(){return n().currentPage},get totalPages(){return n().totalPages},onPageChange:i});var g=D(S,2);Bt(g,{get showCart(){return o()}}),m(d),L(q,d),te(),l()}var It=A('<meta name="description" content="Browse community creations">');function ia(q){Oe(s=>{var v=It();Fe.title="Gallery | Pexos",L(s,v)}),Gt(q,{})}export{ia as component};
