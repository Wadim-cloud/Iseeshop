import{c as W,a as n,t as m}from"../chunks/DPmhzSt5.js";import{i as U}from"../chunks/CHpTJ84V.js";import{p as D,aA as z,ax as M,a as N,Y as v,az as b,Z as g,o as B,aB as H,a1 as i,A as R,t as u}from"../chunks/BDHGhfTE.js";import{e as _,d as Y}from"../chunks/CvTsB6m-.js";import{i as x}from"../chunks/1K336M6a.js";import{p as Z,a as F,b as J}from"../chunks/ChMpMzq7.js";import{p as K}from"../chunks/CsGhAA03.js";import{C as Q}from"../chunks/DR4qTk9g.js";import{s as L}from"../chunks/BqOODIDs.js";import{g as O,i as T}from"../chunks/BimYdWYP.js";var V=m('<div class="modal-overlay svelte-1q5ot2i"><div class="modal svelte-1q5ot2i"><button class="close-button svelte-1q5ot2i">Ã—</button> <h2 class="svelte-1q5ot2i">Sign In</h2> <div class="provider-buttons svelte-1q5ot2i"><button class="provider-button google svelte-1q5ot2i">Sign in with Google</button> <button class="provider-button github svelte-1q5ot2i">Sign in with GitHub</button></div></div></div>');function X(P,S){D(S,!1);let A=Z(S,"show",12);const I=z();async function k(s){console.log("Initiating OAuth with:",s);try{const{error:o}=await L.auth.signInWithOAuth({provider:s,options:{redirectTo:`${window.location.origin}/auth/callback`}});if(o)throw console.error("OAuth error:",o.message),o;console.log("OAuth initiated successfully"),I("authSuccess")}catch(o){console.error("OAuth failed:",o),I("authError",{message:o instanceof Error?o.message:"Authentication failed"})}}U();var a=W(),h=M(a);{var c=s=>{var o=V(),p=v(o),y=v(p),j=b(y,4),w=v(j),q=b(w,2);g(j),g(p),g(o),_("click",y,()=>A(!1)),_("click",w,()=>k("google")),_("click",q,()=>k("github")),n(s,o)};x(h,s=>{A()&&s(c)})}n(P,a),N()}var ee=m('<meta name="description" content="A collaborative creative platform" class="svelte-1aduj7e">'),te=m('<div class="container svelte-1aduj7e" role="status" aria-live="polite"><div class="loading-content svelte-1aduj7e"><img src="/logo192.png" alt="Pexos Logo" class="logo-image floating svelte-1aduj7e"> <p class="loading-text floating svelte-1aduj7e">Loading Pexos...</p></div></div>'),oe=m('<button class="login-button svelte-1aduj7e">Sign In</button>'),ae=m('<div class="container svelte-1aduj7e"><div class="shader-background svelte-1aduj7e"><!></div> <div class="content svelte-1aduj7e"><img src="/logo192.png" alt="Pexos Logo" class="logo-image svelte-1aduj7e"> <h1 class="svelte-1aduj7e">Pexos</h1> <p class="svelte-1aduj7e">A collaborative creative platform</p> <!></div></div>'),se=m("<!> <!>",1);function he(P,S){D(S,!1);const[A,I]=F(),k=()=>J(K,"$page",A);let a=R(!1),h=R(!0),c=R(null);B(async()=>{console.log("Root page mounted");try{const{data:{session:t},error:e}=await L.auth.getSession();e&&console.error("Session check error:",e.message),i(c,t),i(h,!1);const r=k().url.searchParams.get("redirect");r&&(console.log("Redirect param:",r),localStorage.setItem("sb-redirect",decodeURIComponent(r)),u(c)?(console.log("User already signed in, redirecting to:",r),O(decodeURIComponent(r),{replaceState:!0})):i(a,!0));const{data:C}=L.auth.onAuthStateChange(async(f,l)=>{var $;if(console.log("Auth state changed:",f,($=l==null?void 0:l.user)==null?void 0:$.email),i(c,l),f==="SIGNED_IN"&&l){await T();const d=localStorage.getItem("sb-redirect")||"/";localStorage.removeItem("sb-redirect"),console.log("Redirecting after sign-in:",d),O(d,{replaceState:!0})}});return()=>C.subscription.unsubscribe()}catch(t){console.error("Session check failed:",t),i(h,!1)}});const s=()=>{console.log("Sign In button clicked"),i(a,!0)};U();var o=se();Y(t=>{var e=ee();H.title="Pexos - Creative Platform",n(t,e)});var p=M(o);{var y=t=>{var e=te();n(t,e)},j=t=>{var e=ae(),r=v(e),C=v(r);Q(C,{}),g(r);var f=b(r,2),l=b(v(f),6);{var $=d=>{var E=oe();_("click",E,s),_("keydown",E,G=>(G.key==="Enter"||G.key==="Space")&&s()),n(d,E)};x(l,d=>{!u(a)&&!u(c)&&d($)})}g(f),g(e),n(t,e)};x(p,t=>{u(h)?t(y):t(j,!1)})}var w=b(p,2);{var q=t=>{X(t,{get show(){return u(a)},set show(e){i(a,e)},$$events:{authSuccess:async()=>{console.log("Auth success event"),await T();const e=localStorage.getItem("sb-redirect")||"/";localStorage.removeItem("sb-redirect"),console.log("Redirecting after auth success:",e),O(e,{replaceState:!0})},authError:({detail:e})=>{console.log("Auth error:",e.message),i(a,!1)}},$$legacy:!0})};x(w,t=>{u(a)&&t(q)})}n(P,o),N(),I()}export{he as component};
