import{t as P,a as v,c as V}from"../chunks/DPmhzSt5.js";import{i as N}from"../chunks/CHpTJ84V.js";import{p as U,Y as p,az as S,Z as u,ay as F,t as g,a as T,aA as ae,o as se,A as oe,aX as le,a1 as ie,ax as Y,_ as ne,v as $,aB as ve}from"../chunks/BDHGhfTE.js";import{e as L,d as ce}from"../chunks/CvTsB6m-.js";import"../chunks/BimYdWYP.js";import{p as d,b as A,a as re,s as de}from"../chunks/ChMpMzq7.js";import{s as Q}from"../chunks/CTjs_13Y.js";import{i as j}from"../chunks/1K336M6a.js";import{a as q}from"../chunks/D02H29ki.js";import{e as J,i as ge}from"../chunks/CgxHyAce.js";import{w as E}from"../chunks/DH2AK175.js";import{b as ue}from"../chunks/RZ2m-Vl7.js";import{F as me}from"../chunks/BznP9nFT.js";import{s as ee}from"../chunks/5ddwAlOI.js";import{s as te}from"../chunks/BqOODIDs.js";const X=E({});var fe=P('<div class="gallery-item svelte-ttdz5z"><img class="gallery-image svelte-ttdz5z" loading="lazy"> <div class="gallery-meta svelte-ttdz5z"><div class="gallery-stats svelte-ttdz5z"><button class="like-button svelte-ttdz5z"><svg width="20" height="20" viewBox="0 0 24 24" stroke="#333" class="svelte-ttdz5z"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path></svg> <span> </span></button></div> <div class="button-group svelte-ttdz5z"><button class="preview-button svelte-ttdz5z"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#333"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg> Preview</button> <button class="preview-button preview-3d svelte-ttdz5z"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#333"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path><path d="M12 18a6 6 0 100-12 6 6 0 000 12z"></path><path d="M12 14a2 2 0 100-4 2 2 0 000 4z"></path></svg> 3D View</button></div></div></div>'),we=P('<div class="gallery-grid svelte-ttdz5z"></div>');function pe(B,t){U(t,!1);const[a,h]=re(),m=()=>A(X,"$likesStore",a);let k=d(t,"drawings",8),C=d(t,"onLike",8),y=d(t,"onPreview",8),M=d(t,"on3DPreview",8);const b="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2VlZSIvPjx0ZXh0IHg9IjUwIiB5PSI1MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjgiIGZpbGw9IiNjY2MiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiPkxvYWRpbmc8L3RleHQ+PC9zdmc+";N();var I=we();J(I,5,k,z=>z.id,(z,r)=>{var f=fe(),w=p(f);q(w,"src",b);var D=S(w,2),e=p(D),c=p(e),x=p(c),G=S(x,2),o=p(G,!0);u(G),u(c),u(e);var _=S(e,2),s=p(_),W=S(s,2);u(_),u(D),u(f),F(()=>{q(w,"data-src",g(r).image_data),q(w,"alt",`User drawing ${g(r).id}`),q(x,"fill",m()[g(r).id]?"#ff4757":"none"),Q(o,m()[g(r).id]||g(r).likes)}),L("click",w,()=>y()(g(r).image_data)),L("load",w,n=>{const l=n.target;l.dataset.src&&(l.src=l.dataset.src)}),L("click",c,()=>C()(g(r).id)),L("click",s,()=>y()(g(r).image_data)),L("click",W,()=>M()(g(r).image_data)),v(z,f)}),u(I),v(B,I),T(),h()}var he=P('<!> <p class="tip svelte-394hdl">Tip: Use mouse wheel to zoom, click and drag to rotate</p>',1),be=P('<p class="error svelte-394hdl">Image data not available for preview</p>'),_e=P('<div class="modal-backdrop svelte-394hdl" tabindex="-1"><div class="modal-content svelte-394hdl"><button class="close-button svelte-394hdl" aria-label="Close preview"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button> <div class="model-container svelte-394hdl"><h2 class="svelte-394hdl">3D Preview</h2> <!></div></div></div>');function Pe(B,t){U(t,!1);let a=d(t,"imageData",8,null);const h=ae();let m=oe();function k(e){e.target===g(m)&&y()}function C(e){e.key==="Escape"&&y()}function y(){h("close")}const M={stlFile:"/models/tshirt.stl",defaultTextureImage:a()||"/texture/boom.png",width:"100%",height:"400px",backgroundColor:"#f0f0f0",modelColor:"#cccccc",floating:!0,rotationSpeedY:.5,autoRotate:!0,enableZoom:!0,initialZoom:8,drawingData:a()};se(()=>{var e;return document.body.style.overflow="hidden",(e=g(m))==null||e.focus(),()=>{document.body.style.overflow=""}}),N();var b=_e();L("keydown",le,C);var I=p(b),z=p(I),r=S(z,2),f=S(p(r),2);{var w=e=>{var c=he(),x=Y(c);me(x,de(M)),ne(2),v(e,c)},D=e=>{var c=be();v(e,c)};j(f,e=>{a()?e(w):e(D,!1)})}u(r),u(I),u(b),ue(b,e=>ie(m,e),()=>g(m)),L("click",z,y),L("click",b,k),v(B,b),T()}var ke=P('<div class="gallery-loading svelte-1rpzm0c"><div class="loading-spinner svelte-1rpzm0c"></div> <p class="svelte-1rpzm0c">Loading gallery items...</p></div>'),ye=P('<div class="gallery-error svelte-1rpzm0c"><p class="svelte-1rpzm0c"> </p> <button class="svelte-1rpzm0c">Retry</button></div>'),ze=P('<div class="gallery-empty svelte-1rpzm0c"><p class="svelte-1rpzm0c">No drawings found. Be the first to create one!</p></div>'),De=P('<div class="preview-modal svelte-1rpzm0c"><div class="preview-modal-content svelte-1rpzm0c"><button class="close-button svelte-1rpzm0c">×</button> <img alt="Drawing preview" class="svelte-1rpzm0c"></div></div>'),xe=P('<div class="gallery-view svelte-1rpzm0c"><!> <!> <!></div>');function Ce(B,t){U(t,!1);let a=d(t,"drawings",8),h=d(t,"loading",8),m=d(t,"error",8),k=d(t,"selectedDrawing",8),C=d(t,"selected3DDrawing",8),y=d(t,"onLike",8),M=d(t,"onPreview",8),b=d(t,"on3DPreview",8),I=d(t,"onClosePreview",8),z=d(t,"onClose3DPreview",8);N();var r=xe(),f=p(r);{var w=o=>{var _=ke();v(o,_)},D=(o,_)=>{{var s=n=>{var l=ye(),i=p(l),R=p(i);u(i);var Z=S(i,2);u(l),F(()=>Q(R,`Error: ${m()??""}`)),L("click",Z,()=>window.location.reload()),v(n,l)},W=(n,l)=>{{var i=Z=>{var H=ze();v(Z,H)},R=Z=>{pe(Z,{get drawings(){return a()},get onLike(){return y()},get onPreview(){return M()},get on3DPreview(){return b()}})};j(n,Z=>{a().length===0?Z(i):Z(R,!1)},l)}};j(o,n=>{m()?n(s):n(W,!1)},_)}};j(f,o=>{h()?o(w):o(D,!1)})}var e=S(f,2);{var c=o=>{var _=De(),s=p(_),W=p(s),n=S(W,2);u(s),u(_),F(()=>q(n,"src",k())),L("click",W,function(...l){var i;(i=I())==null||i.apply(this,l)}),v(o,_)};j(e,o=>{k()&&o(c)})}var x=S(e,2);{var G=o=>{Pe(o,{get imageData(){return C()},$$events:{close(..._){var s;(s=z())==null||s.apply(this,_)}}})};j(x,o=>{C()&&o(G)})}u(r),v(B,r),T()}var Me=P("<button></button>"),Ie=P("<button> </button>"),Le=P('<span class="svelte-rc3ooi">…</span>'),Be=P('<nav class="pagination svelte-rc3ooi"><button aria-label="Previous Page" class="svelte-rc3ooi">◀ Prev</button> <!> <button aria-label="Next Page" class="svelte-rc3ooi">Next ▶</button></nav>');function Ge(B,t){U(t,!1);let a=d(t,"currentPage",8,1),h=d(t,"totalPages",8,1);const m=ae(),k=r=>{r>=1&&r<=h()&&r!==a()&&m("pageChange",r)};N();var C=Be(),y=p(C),M=S(y,2);{var b=r=>{var f=V(),w=Y(f);J(w,1,()=>Array(h()),ge,(D,e,c)=>{var x=Me();let G;x.textContent=c+1,F(o=>G=ee(x,1,"svelte-rc3ooi",null,G,o),[()=>({selected:c+1===a()})],$),L("click",x,()=>k(c+1)),v(D,x)}),v(r,f)},I=r=>{var f=V(),w=Y(f);J(w,1,()=>[1,a()-1,a(),a()+1,h()],D=>D,(D,e)=>{var c=V(),x=Y(c);{var G=o=>{var _=V(),s=Y(_);{var W=l=>{var i=Ie();let R;var Z=p(i,!0);u(i),F(H=>{R=ee(i,1,"svelte-rc3ooi",null,R,H),Q(Z,g(e))},[()=>({selected:g(e)===a()})],$),L("click",i,()=>k(g(e))),v(l,i)},n=l=>{var i=Le();v(l,i)};j(s,l=>{g(e)!==a()-2&&g(e)!==a()+2?l(W):l(n,!1)})}v(o,_)};j(x,o=>{g(e)>0&&g(e)<=h()&&o(G)})}v(D,c)}),v(r,f)};j(M,r=>{h()<=7?r(b):r(I,!1)})}var z=S(M,2);u(C),F(()=>{y.disabled=a()===1,z.disabled=a()===h()}),L("click",y,()=>k(a()-1)),L("click",z,()=>k(a()+1)),v(B,C),T()}var We=P('<div class="gallery-controls svelte-19aqbvt"><!></div>');function Ze(B,t){U(t,!1);let a=d(t,"currentPage",8),h=d(t,"totalPages",8),m=d(t,"onPageChange",8);N();var k=V(),C=Y(k);{var y=M=>{var b=We(),I=p(b);Ge(I,{get currentPage(){return a()},get totalPages(){return h()},$$events:{pageChange:z=>m()(z.detail)}}),u(b),v(M,b)};j(C,M=>{h()>1&&M(y)})}v(B,k),T()}var Se=P('<div class="gallery-container svelte-1q9azse"><!> <!></div>');function je(B,t){U(t,!1);const[a,h]=re(),m=()=>A(e,"$pagination",a),k=()=>A(X,"$likesStore",a),C=()=>A(z,"$drawings",a),y=()=>A(f,"$loading",a),M=()=>A(r,"$error",a),b=()=>A(w,"$selectedDrawing",a),I=()=>A(D,"$selected3DDrawing",a),z=E([]),r=E(null),f=E(!1),w=E(null),D=E(null),e=E({currentPage:1,totalPages:1,itemsPerPage:40});async function c(s){f.set(!0),r.set(null);const{currentPage:W,itemsPerPage:n}=m(),l=(s-1)*n;try{const{data:i,count:R,error:Z}=await te.from("drawings").select("id, image_data, likes, created_at",{count:"exact"}).order("created_at",{ascending:!1}).range(l,l+n-1);if(Z)throw Z;z.set(i||[]),e.update(H=>({...H,currentPage:s,totalPages:Math.ceil((R||0)/n)})),X.update(H=>{const K={...H};return i==null||i.forEach(O=>K[O.id]=O.likes),K})}catch(i){r.set(i instanceof Error?i.message:"Failed to load drawings"),console.error("Gallery error:",i)}finally{f.set(!1)}}async function x(s){X.update(W=>{const n={...W};return n[s]=(n[s]||0)+1,n});try{await te.from("drawings").update({likes:k()[s]}).eq("id",s)}catch(W){console.error("Like update failed:",W),X.update(n=>{const l={...n};return l[s]=(l[s]||1)-1,l})}}c(1),N();var G=Se(),o=p(G);Ce(o,{get drawings(){return C()},get loading(){return y()},get error(){return M()},get selectedDrawing(){return b()},get selected3DDrawing(){return I()},onLike:x,onPreview:s=>w.set(s),on3DPreview:s=>D.set(s),onClosePreview:()=>w.set(null),onClose3DPreview:()=>D.set(null)});var _=S(o,2);Ze(_,{get currentPage(){return m().currentPage},get totalPages(){return m().totalPages},onPageChange:c}),u(G),v(B,G),T(),h()}var Re=P('<meta name="description" content="Browse community creations">');function $e(B){ce(t=>{var a=Re();ve.title="Gallery | Pexos",v(t,a)}),je(B,{})}export{$e as component};
