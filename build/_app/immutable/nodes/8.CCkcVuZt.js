import{t as oe,a as I}from"../chunks/DxolCNix.js";import"../chunks/Ci8d3Fat.js";import{p as xe,I as B,x as e,o as ge,ao as he,ap as we,aq as Z,a as _e,ar as u,as as m,w as J,A as w,at as b}from"../chunks/B668RH8u.js";import{e as z,s as K}from"../chunks/DhXqswRN.js";import{e as ke,i as ye}from"../chunks/Dxuc275j.js";import{r as Y,s as Se,a as C,b as Le}from"../chunks/DGKrTPFL.js";import{s as je}from"../chunks/BavnsP6q.js";import{b as Ae}from"../chunks/AOsgo3jW.js";import{b as Me}from"../chunks/DF75DhTM.js";import{i as De}from"../chunks/CHu_v1B0.js";import{c as ze,C as Ee,P as Be,W as Ue,A as Ce,D as Re,G as Ve,V as E,a as O,M as Q,d as ee,T as $e,S as Fe}from"../chunks/DV8XoEH0.js";import{S as te}from"../chunks/BI4t4rBC.js";var Te=oe('<div><div class="model-header svelte-1xiknbp"><input type="checkbox"> <span class="svelte-1xiknbp"> </span></div> <div class="model-controls svelte-1xiknbp"><div class="file-upload svelte-1xiknbp"><label class="svelte-1xiknbp">Upload STL</label> <input type="file" accept=".stl" class="svelte-1xiknbp"></div> <div class="file-upload svelte-1xiknbp"><label class="svelte-1xiknbp">Upload Texture</label> <input type="file" accept="image/*" class="svelte-1xiknbp"></div> <div class="color-picker svelte-1xiknbp"><span>Color:</span> <input type="color"></div></div></div>'),Ge=oe('<main><div class="app-container svelte-1xiknbp"><div class="sidebar svelte-1xiknbp"><h2 class="svelte-1xiknbp">STL Viewer</h2> <div class="models-section svelte-1xiknbp"><h3 class="svelte-1xiknbp">Models</h3> <!></div> <div class="scene-controls svelte-1xiknbp"><h3 class="svelte-1xiknbp">Controls</h3> <div class="control-group svelte-1xiknbp"><label for="zoom-level">Zoom Level</label> <input type="range" id="zoom-level" min="0" max="100" step="1" class="svelte-1xiknbp"> <span> </span></div> <button class="svelte-1xiknbp">Reset Camera</button> <button class="svelte-1xiknbp">Export as PNG</button></div></div> <div class="canvas-container svelte-1xiknbp"><canvas class="svelte-1xiknbp"></canvas></div></div></main>');function Qe(ae,se){xe(se,!1);let c=B([{id:1,name:"Model 1",file:null,object:null,color:"#ff0000",texture:null,position:[0,0,0],visible:!0,path:"/models/Dobbelsteen.stl"},{id:2,name:"Model 2",file:null,object:null,color:"#00ff00",texture:null,position:[3,0,0],visible:!0,path:"/models/test.stl"},{id:3,name:"Model 3",file:null,object:null,color:"#0000ff",texture:null,position:[-3,0,0],visible:!0,path:"/models/tshirt.stl"}]),P=B(e(c)[0]),S=B(50),_=B(),g,d=B(),A,n=B(),R=!1,U={x:0,y:0};ge(async()=>{g=new ze,g.background=new Ee("#e0e0e0"),w(d,new Be(50,600/400,.1,1e4)),e(d).position.set(10,10,20),e(d).lookAt(0,0,0),A=new Ue({canvas:e(_),antialias:!0,preserveDrawingBuffer:!0}),A.setSize(600,400),A.shadowMap.enabled=!0;const r=new Ce(16777215,.5);g.add(r);const t=new Re(16777215,1);t.position.set(5,10,7),t.castShadow=!0,g.add(t);const i=new Ve(20,20,8947848,4473924);g.add(i),w(n,{target:new E(0,0,0),minDistance:5,maxDistance:50,zoomSpeed:1,rotateSpeed:.05,panSpeed:.1});const a=o=>{R=!0,U={x:o.clientX,y:o.clientY}},h=o=>{if(!R)return;const p=o.clientX-U.x,k=o.clientY-U.y;if(o.buttons===1){const s=k*e(n).rotateSpeed,L=p*e(n).rotateSpeed,f=e(d).position.clone().sub(e(n).target),j=f.length();f.applyAxisAngle(new E(0,1,0),-L);const y=new E().crossVectors(f,new E(0,1,0)).normalize();f.applyAxisAngle(y,-s),e(d).position.copy(e(n).target).add(f.normalize().multiplyScalar(j)),e(d).lookAt(e(n).target)}else if(o.buttons===2){const s=new E(-p*e(n).panSpeed,k*e(n).panSpeed,0);e(n).target.add(s),e(d).position.add(s),e(d).lookAt(e(n).target)}U={x:o.clientX,y:o.clientY}},v=()=>{R=!1},M=o=>{o.preventDefault();const p=o.deltaY>0?-1:1;w(S,Math.max(0,Math.min(100,e(S)+p*e(n).zoomSpeed)))};e(_).addEventListener("mousedown",a),e(_).addEventListener("mousemove",h),e(_).addEventListener("mouseup",v),e(_).addEventListener("wheel",M,{passive:!1});const l=new te;for(const o of e(c))if(o.path)try{console.log(`Loading model: ${o.name}`);const p=await fetch(o.path);if(!p.ok)throw new Error(`Failed to fetch ${o.path}`);const k=await p.arrayBuffer(),s=l.parse(k);if(s.center(),!s.attributes.uv){s.computeVertexNormals(),s.computeBoundingBox();const f=s.boundingBox,j=new E;f.getSize(j);const y=new Float32Array(s.attributes.position.count*2);for(let x=0;x<s.attributes.position.count;x++){const be=s.attributes.position.array[x*3],fe=s.attributes.position.array[x*3+1];y[x*2]=(be-f.min.x)/j.x,y[x*2+1]=(fe-f.min.y)/j.y}s.setAttribute("uv",new O(y,2))}const L=new Q({color:o.color,roughness:.7,metalness:.2,map:null});o.object=new ee(s,L),o.object.position.set(...o.position),o.object.castShadow=!0,o.object.receiveShadow=!0,o.visible&&g.add(o.object),w(c,[...e(c)]),console.log(`Successfully loaded model: ${o.name}`)}catch(p){console.error(`Error loading model ${o.name}:`,p)}const D=()=>{requestAnimationFrame(D),A.render(g,e(d))};return D(),()=>{e(_).removeEventListener("mousedown",a),e(_).removeEventListener("mousemove",h),e(_).removeEventListener("mouseup",v),e(_).removeEventListener("wheel",M),A.dispose()}});function ie(r,t){const i=r.target.files[0];if(!i)return;const a=e(c).find(v=>v.id===t);if(!a)return;const h=new FileReader;h.onload=v=>{const l=new te().parse(v.target.result);if(l.center(),!l.attributes.uv){l.computeVertexNormals(),l.computeBoundingBox();const o=l.boundingBox,p=new E;o.getSize(p);const k=new Float32Array(l.attributes.position.count*2);for(let s=0;s<l.attributes.position.count;s++){const L=l.attributes.position.array[s*3],f=l.attributes.position.array[s*3+1];k[s*2]=(L-o.min.x)/p.x,k[s*2+1]=(f-o.min.y)/p.y}l.setAttribute("uv",new O(k,2))}a.object&&g.remove(a.object);const D=new Q({color:a.color,roughness:.7,metalness:.2,map:a.texture?a.texture:null});a.object=new ee(l,D),a.object.position.set(...a.position),a.object.castShadow=!0,a.object.receiveShadow=!0,a.visible&&g.add(a.object),a.file=i,w(c,[...e(c)])},h.readAsArrayBuffer(i)}function ne(r,t){const i=r.target.files[0];if(!i)return;const a=e(c).find(v=>v.id===t);if(!a||!a.object)return;const h=new FileReader;h.onload=v=>{const l=new $e().load(v.target.result);l.colorSpace=Fe,a.texture=l,a.object.material.map=l,a.object.material.needsUpdate=!0,w(c,[...e(c)])},h.readAsDataURL(i)}function re(r,t){const i=e(c).find(a=>a.id===r);i&&i.object&&(i.color=t,i.object.material.color.set(t),i.object.material.needsUpdate=!0,w(c,[...e(c)]))}function le(r){const t=e(c).find(i=>i.id===r);t&&t.object&&(t.visible=!t.visible,t.visible?g.add(t.object):g.remove(t.object),w(c,[...e(c)]))}function ce(){w(S,50),e(d).position.set(10,10,20),e(n).target.set(0,0,0),e(d).lookAt(e(n).target)}function de(){A.render(g,e(d));const r=A.domElement.toDataURL("image/png"),t=document.createElement("a");t.href=r,t.download="viewport-snapshot.png",t.click()}he(()=>(e(d),e(n),e(S)),()=>{if(e(d)&&e(n)){const r=e(n).minDistance+(e(n).maxDistance-e(n).minDistance)*(e(S)/100),t=e(d).position.clone().sub(e(n).target).normalize();e(d).position.copy(e(n).target).add(t.multiplyScalar(r)),e(d).lookAt(e(n).target)}}),we(),De();var V=Ge(),X=m(V),$=m(X),F=u(m($),2),pe=u(m(F),2);ke(pe,1,()=>e(c),ye,(r,t)=>{var i=Te();let a;var h=m(i),v=m(h);Y(v);var M=u(v,2),l=m(M,!0);b(M),b(h);var D=u(h,2),o=m(D),p=m(o),k=u(p,2);b(o);var s=u(o,2),L=m(s),f=u(L,2);b(s);var j=u(s,2),y=u(m(j),2);Y(y),b(j),b(D),b(i),Z(x=>{a=je(i,1,"model-item svelte-1xiknbp",null,a,x),Se(v,e(t).visible),K(l,e(t).name),C(p,"for",`file-${e(t).id}`),C(k,"id",`file-${e(t).id}`),C(L,"for",`texture-${e(t).id}`),C(f,"id",`texture-${e(t).id}`),Le(y,e(t).color)},[()=>({selected:e(P).id===e(t).id})],J),z("change",v,()=>le(e(t).id)),z("change",k,x=>ie(x,e(t).id)),z("change",f,x=>ne(x,e(t).id)),z("input",y,x=>re(e(t).id,x.target.value)),z("click",i,()=>w(P,e(t))),I(r,i)}),b(F);var q=u(F,2),T=u(m(q),2),G=u(m(T),2);Y(G);var N=u(G,2),ue=m(N,!0);b(N),b(T);var W=u(T,2),ve=u(W,2);b(q),b($);var H=u($,2),me=m(H);Me(me,r=>w(_,r),()=>e(_)),b(H),b(X),b(V),Z(r=>K(ue,r),[()=>Math.round(e(S))],J),Ae(G,()=>e(S),r=>w(S,r)),z("click",W,ce),z("click",ve,de),I(ae,V),_e()}export{Qe as component};
